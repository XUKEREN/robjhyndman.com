<!doctype html>
<html class="no-js" lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>Major changes to the forecast package | Rob J Hyndman</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans|Merriweather" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/foundation.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/highlight.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/academicons.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/finite.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/kube.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/robjhyndman.css">
</head>
  <body>
    <header>
      <nav class="nav-bar">
	
	  <div class="title-bar" data-responsive-toggle="site-menu" data-hide-for="medium">
	    <button class="site-hamburger" type="button" data-toggle>
	      <i class="fa fa-bars fa-lg" aria-hidden="true"></i>
	    </button>
	    <div class="title-bar-title site-title">
	      <a href="https://robjhyndman.com/"  style="color: #b3cde0">Rob J Hyndman</a>
	    </div>
	    <div class="title-bar-right pull-right">
	      


	    </div>
	  </div>

	  
	    <div class="top-bar" id="site-menu" >
	      <div class="top-bar-title show-for-medium site-title">
		<a href="https://robjhyndman.com/"  style="color: #b3cde0;">Rob J Hyndman</a>
	      </div>
	      <div class="top-bar-left">
		<ul class="menu vertical medium-horizontal">
		  
		  
		  <li><a href="https://robjhyndman.com/hyndsight/">Hyndsight blog</a></li>
		  
		  <li><a href="https://robjhyndman.com/publications/">Publications</a></li>
		  
		  <li><a href="https://robjhyndman.com/software/">Software</a></li>
		  
		  <li><a href="https://robjhyndman.com/seminars/">Seminars</a></li>
		  
		  <li><a href="https://robjhyndman.com/teaching/">Teaching</a></li>
		  
		  <li><a href="https://robjhyndman.com/research-team/">Research team</a></li>
		  
		  <li><a href="https://robjhyndman.com/about/">About</a></li>
		  
		</ul>
	      </div>
	      <div class="top-bar-right show-for-medium">
		


	      </div>
	    </div>
	  
	</nav>
    </header>
    <main>
      

<div class="wrapper">
<div class="units-row" style='margin-bottom: 0px;'>
<div class="unit-20">&nbsp;</div>
<div class="unit-60"><h1>Major changes to the forecast package</h1></div>
</div>
<div class="units-row">
  <div class="unit-20 dateblock" style='text-align: right;'><h4 style='padding: .8ex 0px .8ex 0px;'><a href="https://robjhyndman.com/hyndsight">Hyndsight</a></h4>
      <div class="post-metadata">
  <span class="post-date">
    <time datetime="2011-08-26 00:20:04 &#43;0000 &#43;0000" itemprop="datePublished">26 August 2011</time>
  </span>
  
  
  
  <span class="post-tags">
    <p><i class="fa fa-tags"></i>
    
    <a class="post-tag" href="https://robjhyndman.com/categories/forecasting">forecasting</a>,
     
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/r">R</a>
    
  </span>
  
  
</div>

    </div>
<div class="unit-60">

  

<p>The <a href="http://cran.r-project.org/web/packages/forecast/">forecast package for R</a> has undergone a major upgrade, and I&rsquo;ve given it version number 3 as a result. Some of these changes were suggestions from the forecasting workshop I ran in Switzerland a couple of months ago, and some have been on the drawing board for a long time. Here are the main changes in version 3, plus a few earlier additions that I thought deserved a mention.
<!-- more --></p>

<h3 id="box-cox-transformations">Box-Cox transformations</h3>

<p>A Box-Cox transformation can now be incorporated into the forecasting model when calling <code>Arima()</code>, <code>auto.arima()</code>, <code>ets()</code>, <code>arfima()</code>, <code>tslm()</code>, <code>stlf()</code>, <code>rwf()</code>, <code>meanf()</code>, or <code>splinef()</code>. For example:</p>

<pre><code class="language-r">fit &lt;- Arima(lynx, order=c(2,0,0), lambda=0.5)
plot(forecast(fit,h=20))
</code></pre>

<p>The model is based on the transformed data, forecasts are calculated, and then the forecasts and prediction intervals are back-transformed. The point forecasts can be interpreted as medians after back-transforming.</p>

<p>If the transformation is done outside the fitting function, the forecasts can still be back-transformed. For example:</p>

<pre><code class="language-r">fit &lt;- ar(BoxCox(lynx,0.5))
plot(forecast(fit,lambda=0.5))
</code></pre>

<p>Back-transforming forecasts like this is now available in <code>forecast.Arima()</code>, <code>forecast.ets()</code>, <code>forecast.fracdiff()</code>, <code>forecast.ar()</code>, <code>forecast.StructTS()</code>, and <code>forecast.HoltWinters()</code>.</p>

<p>I have also added a function for automatically choosing the Box-Cox parameter using either Guerrero&rsquo;s (1993) method or the profile log likelihood method. For example:</p>

<pre><code class="language-r">fit &lt;- Arima(lynx, order=c(2,0,0), lambda=BoxCox.lambda(lynx))
plot(forecast(fit))
</code></pre>

<p>Note that previously there was a lambda argument in the <code>plot.forecast()</code> function. This is no longer available (and so some old code may break). Instead, back-transform the forecasts within the <code>forecast()</code> function.</p>

<h3 id="improved-auto-arima">Improved auto.arima()</h3>

<p>The <code>auto.arima()</code> function is widely used for automatically selecting ARIMA models. It works quite well, except that selection of $D$, the order of seasonal differencing, has always been poor. Up until now, the default has been to use the Canova-Hansen test to select $D$. Because the CH test has a null hypothesis of deterministic seasonality based on dummy variables, the function will often select $D=0$. So I&rsquo;ve now switched to using the OCSB test for selecting $D$ which has a null hypothesis involving a seasonal difference, so it is much more likely to choose $D=1$ than previously. I&rsquo;ve done extensive testing of the forecasts obtained under the two methods, and the OCSB test leads to better forecasts. Hence it is now the default. This means that the function may return a different ARIMA model than previously when the data are seasonal.</p>

<p>A separate function for selecting the seasonal order has also been made visible. So you can now call <code>nsdiffs()</code> to find the recommended number of seasonal differences without calling <code>auto.arima()</code>. There is also a <code>ndiffs()</code> function for selecting the number of first differences. Within <code>auto.arima()</code>, <code>nsdiffs()</code> is called first to select $D$, and then <code>ndiffs()</code> is applied to <code>diff(x,D)</code> if $D&gt;0$ or to <code>x</code> if $D=0$.</p>

<h3 id="double-seasonal-holt-winters">Double-seasonal Holt-Winters</h3>

<p>The new <code>dshw()</code> function implements Taylor&rsquo;s (2003) double-seasonal Holt-Winters method. This allows for two levels of seasonality. For example, with hourly data, there is often a daily period of 24 and a weekly period of 168. These are modelled separately in the <code>dshw()</code> function.</p>

<p>I am planning some major new functionality to extend this to the various types of complex seasonality discussed in <a href="https://robjhyndman.com/publications/complex-seasonality/">my recent JASA paper</a>. Hopefully that will be ready in the next few weeks &ndash; I have a research assistant working on the new code.</p>

<h3 id="sub-setting-time-series">Sub-setting time series</h3>

<p>Occasionally you want to extract all the Novembers in a monthly time series (or something similar), but this has been fiddly to do up to now. So I&rsquo;ve included a new function <code>subset.ts</code>. For example:</p>

<pre><code class="language-r">plot(subset(gas,month=&quot;November&quot;))
subset(woolyrnq,quarter=3)
</code></pre>

<h3 id="acf-and-pacf">Acf() and Pacf()</h3>

<p>These were actually added in v2.19 but I&rsquo;ve not mentioned them anywhere so I thought it would be useful to say something here. The <code>acf()</code> function always includes a spike of length 1 at lag 0. This is pointless because the ACF at lag 0 is 1 by definition. It is also annoying because it forces the scale of the y-axis to include 1 which can obscure smaller correlations that might be of interest. The <code>Acf()</code> function works in the same way as the <code>acf()</code> function except that it omits lag 0. The <code>Pacf()</code> function is included for consistency only &mdash; it returns the same object and produces the same plot as <code>pacf()</code>.</p>

<h3 id="time-series-linear-models">Time series linear models</h3>

<p>Another recent addition, but not new in v3, is the <code>tslm()</code> function for handling linear models for time series. This works in the same way as <code>lm()</code> except that the time series characteristics of the data are preserved in the residuals and fitted values. Also, the variables <code>trend</code> and <code>seasonal</code> can be used without needing to be defined. For example:</p>

<pre><code class="language-r">y &lt;- ts(rnorm(120,0,3) + 20*sin(2*pi*(1:120)/12), frequency=12)
fit1 &lt;- tslm(y ~ trend + season)
plot(forecast(fit1))
</code></pre>

<p><code>trend</code> takes values $1,2,\dots,n$ where $n$ is the length of <code>y</code>, and <code>season</code> is a matrix of seasonal dummy variables.</p>

<h3 id="cross-validation">Cross-validation</h3>

<p>The <code>CV()</code> function is another addition from earlier in the year. It implements the <a href="https://robjhyndman.com/hyndsight/crossvalidation/">cross-validation statistic</a>, AIC, corrected AIC, BIC and adjusted R2 values for a linear model. For example:</p>

<pre><code class="language-r">y &lt;- ts(rnorm(120,0,3) + 20*sin(2*pi*(1:120)/12), frequency=12)
fit1 &lt;- tslm(y ~ trend + season)
fit2 &lt;- tslm(y ~ season)
CV(fit1)
CV(fit2)
</code></pre>

<p><code>CV</code> works with any lm objects including those produced by <code>tslm()</code> and <code>lm()</code>.</p>

<h3 id="forecasting-with-stl">Forecasting with STL</h3>

<p>This functionality was added earlier in the year, but it is so cool I wanted to mention it here. STL is a great method for decomposing time series into trend, seasonal and irregular components. It is robust and handles time series of any frequency.</p>

<p>To forecast with STL, you seasonally adjust the data by subtracting the seasonal component, then forecast the seasonally adjusted data using a non-seasonal ARIMA or ETS model, then re-seasonalize the forecasts by adding back in the most recent values of the seasonal component (effectively using a seasonal naive forecast for the seasonal component). The whole procedure is handled effortlessly as follows</p>

<pre><code class="language-r">fit &lt;- stl(USAccDeaths,s.window=&quot;periodic&quot;)
plot(forecast(fit))
</code></pre>

<p>There is also a new function <code>stlf()</code> which does the STL decomposition as well as the forecasting in one step.</p>

<pre><code class="language-r">plot(stlf(AirPassengers, lambda=BoxCox.lambda(AirPassengers)))
</code></pre>

<p>STL decompositions are always additive, but the inclusion of the Box-Cox parameter as shown here allows non-additive decompositions as well.</p>

<p>For data with high seasonal period (such as weekly data, hourly data, etc.), forecasting with STL is often the simplest approach. It also works amazingly well on a wide range of series. If you apply the <code>forecast()</code> function to a time series (rather than a time series model), the forecasts returned will be from <code>stlf()</code> when the seasonal period is 13 or more.</p>

<h3 id="other-changes">Other changes</h3>

<p>A list of all changes to the forecast package is maintained in the <a href="http://pkg.robjhyndman.com/forecast/news/">ChangeLog</a>.</p>

<p>With so many changes and new functions, I&rsquo;ve probably introduced new bugs. Please let me know if you find any problems and I&rsquo;ll endeavour to fix anything ASAP. (Make sure you get v3.02 or later as v3.00 had some bugs.)</p>


      <meta itemprop="wordCount" content="1122">
      <meta itemprop="datePublished" content="2011-08-26">
      <meta itemprop="url" content="https://robjhyndman.com/hyndsight/forecast3/">

<div class='sans' style="background: #dddddd; padding: 2em;">
<div style="padding-bottom: 1em" >
<div class="share-box">
  <ul class="share">
    <li>
      <a class="facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fforecast3%2f" target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter" href="https://twitter.com/intent/tweet?text=Major%20changes%20to%20the%20forecast%20package. https%3a%2f%2frobjhyndman.com%2fhyndsight%2fforecast3%2f from @robjhyndman" target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fforecast3%2f&amp;title=Major%20changes%20to%20the%20forecast%20package" target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo" href="http://service.weibo.com/share/share.php?url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fforecast3%2f&amp;title=Major%20changes%20to%20the%20forecast%20package" target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email" href="mailto:?subject=Major%20changes%20to%20the%20forecast%20package&amp;body=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fforecast3%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


</div>

    <ul class="pagination" role="navigation" aria-label="Pagination">
      
      <li class="arrow" aria-disabled="true"><a href="https://robjhyndman.com/hyndsight/crowd-sourcing-forecasts/">&laquo; <em>Previous<span class="show-for-sr"> page</span></em>: Crowd sourcing forecasts</a></li>
      
      
      <li class="arrow" aria-disabled="true"><a href="https://robjhyndman.com/hyndsight/tscvexample/"><em>Next<span class="show-for-sr"> page</span></em>: Time series cross-validation: an R example&nbsp;&raquo;</a></li>
      
    </ul>
    <a href="https://robjhyndman.com/hyndsight/">All Hyndsight posts by date</a>
</div>

<span style='font-family: Carlito'>
 <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
              return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'researchtips';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</span>

  </div>
  </div></div>

    </main>
    <footer class="whatisthis">
  <hr class='separator'/>
  <span style="font-family: Carlito, sans; font-size: 0.9em; line-height: 1.05em;">
  <div class="row">
    <div class="column small-12 medium-4">
      <figure class='image-left'>
      <a href="https://robjhyndman.com/" style="border-bottom: none;">
      	<img src="https://robjhyndman.com/img/rjh.png" alt="Portrait of the author" class='avatar' style="max-width: 50%;">
      </a>
  </figure>
  <p>
Rob&nbsp;J&nbsp;Hyndman is Professor of Statistics at <a href=https://www.monash.edu>Monash University</a>, Australia, and Editor-​​in-​​Chief of the <a href=https://ijf.forecasters.org>Inter­na­tional Jour­nal of Fore­cast­ing</a>.  </p>
    </div>
    <div class="column small-12 medium-4">
      
      <h4 id="contact">Contact</h4>
      <ul class="fa-ul">
	
	<li><i class="fa-li fa fa-university" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.monash.edu/business/econometrics-and-business-statistics">Department of Econometrics &amp; Business Statistics, Monash University, Clayton VIC 3800, Australia.</a></li>
	
	<li><i class="fa-li fa fa-envelope" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="mailto:Rob.Hyndman@monash.edu">Rob.Hyndman@monash.edu</a></li>
	
	<li><i class="fa-li fa fa-twitter" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://twitter.com/robjhyndman">@robjhyndman</a> on Twitter</li>
	
	<li><i class="fa-li fa fa-github-alt" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://github.com/robjhyndman/">robjhyndman</a> on GitHub</li>
	
	<li><i class="fa-li ai ai-google-scholar" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://scholar.google.com/citations?user=vamErfkAAAAJ">Google Scholar</a></li>
	
      </ul>
    </div>
    <div class="column small-12 medium-4">
      <h4>Subscribe</h4>
      <p><i><i class="fa fa-rss-square" style="color:#03396c;"></i> To receive updates from this site, you can subscribe to using an <a href="http://feeds.feedburner.com/ProfessorRobJHyndman">RSS feed reader</a> or <a href="https://feedburner.google.com/fb/a/mailverify?uri=ProfessorRobJHyndman">by email</a>.</i></p>
      <h4>Search</h4>
      <a id="searchsite">
	<form method="get" action="https://duckduckgo.com/">
	  <label for="search-field" class="show-for-sr">Search the site</label>
	  <input type="search" name="q" maxlength="255" placeholder="Search the site" id="search-field">
	  <input type="hidden" name="sites" value="https://robjhyndman.com"/>
	  <input type="hidden" name="k7" value="#faf8f8"/>
	  <input type="hidden" name="kj" value="#b33"/>
	  <input type="hidden" name="ky" value="#fafafa"/>
	  <input type="hidden" name="kx" value="b"/>
	  <input type="hidden" name="ko" value="-1"/>
	  <input type="hidden" name="k1" value="-1"/>
	  <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" />
	</form>
      </a>
    </div>
  </div>
  </span>
</footer>

    <div class="endofpage">
    <footer id="footer">
    <section class="wrapper small">Powered by <a href="http://gohugo.io">Hugo</a>
    and <a href="https://github.com/rstudio/blogdown">Blogdown</a>.
     &copy; <a href="https://robjhyndman.com">Rob&nbsp;J&nbsp;Hyndman</a> 1993&ndash;2018.
    </section>
    </footer>
    </div>

    <script src="https://robjhyndman.com/js/jquery.js"></script>
    <script src="https://robjhyndman.com/js/what-input.js"></script>
    <script src="https://robjhyndman.com/js/foundation.min.js"></script>
    <script src="https://robjhyndman.com/js/finite.js"></script>

    
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script>
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>

    
    
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
    </script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML">
    </script>
    


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5004894-1', 'auto');
ga('send', 'pageview');
</script>

 </body>
</html>
