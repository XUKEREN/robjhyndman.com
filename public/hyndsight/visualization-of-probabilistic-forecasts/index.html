<!doctype html>
<html class="no-js" lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>Visualization of probabilistic forecasts | Rob J Hyndman</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans|Merriweather" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
    <link rel="stylesheet" href="/css/foundation.min.css">
    <link rel="stylesheet" href="/css/highlight.min.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/academicons.min.css">
    <link rel="stylesheet" href="/css/finite.css">
    <link rel="stylesheet" href="/css/kube.css">
    <link rel="stylesheet" href="/css/robjhyndman.css">
</head>
  <body>
    <header>
      <nav class="nav-bar">
	
	  <div class="title-bar" data-responsive-toggle="site-menu" data-hide-for="medium">
	    <button class="site-hamburger" type="button" data-toggle>
	      <i class="fa fa-bars fa-lg" aria-hidden="true"></i>
	    </button>
	    <div class="title-bar-title site-title">
	      <a href="/"  style="color: #b3cde0">Rob J Hyndman</a>
	    </div>
	    <div class="title-bar-right pull-right">
	      


	    </div>
	  </div>

	  
	    <div class="top-bar" id="site-menu" >
	      <div class="top-bar-title show-for-medium site-title">
		<a href="/"  style="color: #b3cde0;">Rob J Hyndman</a>
	      </div>
	      <div class="top-bar-left">
		<ul class="menu vertical medium-horizontal">
		  
		  
		  <li><a href="/hyndsight/">Hyndsight blog</a></li>
		  
		  <li><a href="/publications/">Publications</a></li>
		  
		  <li><a href="/software/">Software</a></li>
		  
		  <li><a href="/seminars/">Seminars</a></li>
		  
		  <li><a href="/teaching/">Teaching</a></li>
		  
		  <li><a href="/research-team/">Research team</a></li>
		  
		  <li><a href="/about/">About</a></li>
		  
		</ul>
	      </div>
	      <div class="top-bar-right show-for-medium">
		


	      </div>
	    </div>
	  
	</nav>
    </header>
    <main>
      

<div class="wrapper">
<div class="units-row" style='margin-bottom: 0px;'>
<div class="unit-20">&nbsp;</div>
<div class="unit-60"><h1>Visualization of probabilistic forecasts</h1></div>
</div>
<div class="units-row">
  <div class="unit-20 dateblock" style='text-align: right;'><h4 style='padding: .8ex 0px .8ex 0px;'><a href="/hyndsight">Hyndsight</a></h4>
      <div class="post-metadata">
  <span class="post-date">
    <time datetime="2014-11-21 06:40:51 &#43;0000 &#43;0000" itemprop="datePublished">21 November 2014</time>
  </span>
  
  
  
  <span class="post-tags">
    <p><i class="fa fa-tags"></i>
    
    <a class="post-tag" href="/categories/forecasting">forecasting</a>,
     
    
    
    <a class="post-tag" href="/categories/graphics">graphics</a>, 
    
    
    <a class="post-tag" href="/categories/r">R</a>, 
    
    
    <a class="post-tag" href="/categories/statistics">statistics</a>
    
  </span>
  
  
</div>

    </div>
<div class="unit-60">

  <p>This week my research group discussed Adrian Raftery’s recent paper on <a href="http://arxiv.org/abs/1408.4812">“Use and Communication of Probabilistic Forecasts”</a> which provides a fascinating but brief survey of some of his work on modelling and communicating uncertain futures. Coincidentally, today I was also sent a copy of David Spiegelhalter’s paper on <a href="http://www.sciencemag.org/content/333/6048/1393.abstract">“Visualizing Uncertainty About the Future”</a>. Both are well-worth reading.</p>
<p>It made me think about my own efforts to communicate future uncertainty through graphics. Of course, for time series forecasts I normally show prediction intervals. I prefer to use more than one interval at a time because it helps convey a little more information. The default in the forecast package for R is to show both an 80% and a 95% interval like this:<!-- more --></p>
<pre class="r"><code>library(forecast)
fit &lt;- ets(fma::hsales)
plot(forecast(fit), include=120)</code></pre>
<p><img src="/hyndsight/2014-11-21-visualization-of-probabilistic-forecasts_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>It is sometimes preferable to use a 50% and a 95% interval, rather like a boxplot:</p>
<pre class="r"><code>plot(forecast(fit, level=c(50,95)), include=120)</code></pre>
<p><img src="/hyndsight/2014-11-21-visualization-of-probabilistic-forecasts_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>In some circles (especially macroeconomic forecasting), fan charts are popular:</p>
<pre class="r"><code>plot(forecast(fit,fan=TRUE),include=120)</code></pre>
<p><img src="/hyndsight/2014-11-21-visualization-of-probabilistic-forecasts_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Personally, I don’t like these at all as they lose any specific probabilistic interpretability. What does the darker shaded region actually refer to? At least in the previous version, it is clear that the dark region contains 50% of the probability.</p>
<p>For multi-modal distributions I like to use highest density regions. Here is an example applied to Nicholson’s blowfly data using a threshold model:</p>
<p><a href="/files/Screenshot-from-2014-11-21-154237.png"><img src="/files/Screenshot-from-2014-11-21-154237.png" alt="Screenshot from 2014-11-21 15:42:37" /></a></p>
<p>The dark region has 50% coverage and the light region has 95% coverage. The forecast distributions become bimodal after the first ten iterations, and so the 50% region is split in two to show that. This graphic was taken from a <a href="/publications/highest-density-forecast-regions-for-non-linear-and-non-normal-time-series-models/"><em>J. Forecasting</em> paper</a> I wrote in 1996, so these ideas have been around for a while!</p>
<p>It is easy enough to produce forecast HDR with time series. Here is some R code to do it:</p>
<pre class="r"><code>#HDR for time series object
# Assumes that forecasts can be computed and futures simulated from object
forecasthdr &lt;- function(object, h = ifelse(object$m &gt; 1, 2 * object$m, 10),
                        nsim=2000, plot=TRUE, level=c(50,95), xlim=NULL, ylim=NULL, ...)
{
  require(hdrcde)
  set.seed(2014)
  # Compute forecasts
  fc &lt;- forecast(object)
  ft &lt;- time(fc$mean)

  # Simulate future sample paths
  sim &lt;- matrix(0,nrow=h,ncol=nsim)
  for(i in 1:nsim)
    sim[,i] &lt;- simulate(object, nsim=h)

  # Compute HDRs
  nl &lt;- length(level)
  hd &lt;- array(0, c(h,nl,10))
  mode &lt;- numeric(h)
  for(k in 1:h)
  {
    hdtmp &lt;- hdr(sim[k,], prob=level)
    hd[k,,1:ncol(hdtmp$hdr)] &lt;- hdtmp$hdr
    mode[k] &lt;- hdtmp$mode
  }
  # Remove unnecessary sections of HDRs
  nz &lt;- apply(abs(hd),3,sum) &gt; 0
  hd &lt;- hd[,,nz]
  dimnames(hd)[[1]] &lt;- 1:h
  dimnames(hd)[[2]] &lt;- level


  # Produce plot if required
  if(plot)
  {
    if(is.null(xlim))
      xlim &lt;- range(time(object$x),ft)
    if(is.null(ylim))
      ylim &lt;- range(object$x, hd)
    plot(object$x,xlim=xlim, ylim=ylim, ...)
    # Show HDRs
    cols &lt;- rev(colorspace::sequential_hcl(52))[level - 49]
    for(k in 1:h)
    {
      for(j in 1:nl)
      {
        hdtmp &lt;- hd[k,j,]
        nint &lt;- length(hdtmp)/2
        for(l in 1:nint)
        {
          polygon(ft[k]+c(-1,-1,1,1)/object$m/2,
                  c(hdtmp[2*l-1],hdtmp[2*l],hdtmp[2*l],hdtmp[2*l-1]),
                col=cols[j], border=FALSE)
        }
      }
      points(ft[k], mode[k], pch=19, col=&quot;blue&quot;,cex=0.8)
    }
    #lines(fc$mean,col=&#39;blue&#39;,lwd=2)
  }

  # Return HDRs
  return(list(hdr=hd,mode=mode,level=level))
}</code></pre>
<p>We can apply it using the example I started with:</p>
<pre class="r"><code>z &lt;- forecasthdr(fit,xlim=c(1986,1998),nsim=5000,
                  xlab=&quot;Year&quot;,ylab=&quot;US monthly housing sales&quot;)</code></pre>
<p><img src="/hyndsight/2014-11-21-visualization-of-probabilistic-forecasts_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>The dots are modes of the forecast distributions, and the 50% and 95% highest density regions are also shown. In this case, the distributions are unimodal, and so all the regions are intervals.</p>


      <meta itemprop="wordCount" content="519">
      <meta itemprop="datePublished" content="2014-11-21">
      <meta itemprop="url" content="/hyndsight/visualization-of-probabilistic-forecasts/">

<div class='sans' style="background: #dddddd; padding: 2em;">
<div style="padding-bottom: 1em" >
<div class="share-box">
  <ul class="share">
    <li>
      <a class="facebook" href="http://www.facebook.com/sharer.php?u=%2fhyndsight%2fvisualization-of-probabilistic-forecasts%2f" target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter" href="https://twitter.com/intent/tweet?text=Visualization%20of%20probabilistic%20forecasts. %2fhyndsight%2fvisualization-of-probabilistic-forecasts%2f from @robjhyndman" target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fhyndsight%2fvisualization-of-probabilistic-forecasts%2f&amp;title=Visualization%20of%20probabilistic%20forecasts" target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo" href="http://service.weibo.com/share/share.php?url=%2fhyndsight%2fvisualization-of-probabilistic-forecasts%2f&amp;title=Visualization%20of%20probabilistic%20forecasts" target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email" href="mailto:?subject=Visualization%20of%20probabilistic%20forecasts&amp;body=%2fhyndsight%2fvisualization-of-probabilistic-forecasts%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


</div>

    <ul class="pagination" role="navigation" aria-label="Pagination">
      
      <li class="arrow" aria-disabled="true"><a href="/hyndsight/ijf-review-papers/">&laquo; <em>Previous<span class="show-for-sr"> page</span></em>: IJF review papers</a></li>
      
      
      <li class="arrow" aria-disabled="true"><a href="/hyndsight/hmd-australia/"><em>Next<span class="show-for-sr"> page</span></em>: New Australian data on the HMD&nbsp;&raquo;</a></li>
      
    </ul>
    <a href="/hyndsight/">All Hyndsight posts by date</a>
</div>

<span style='font-family: Carlito'>
 <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
              return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'researchtips';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</span>

  </div>
  </div></div>

    </main>
    <footer class="whatisthis">
  <hr class='separator'/>
  <span style="font-family: Carlito, sans; font-size: 0.9em; line-height: 1.05em;">
  <div class="row">
    <div class="column small-12 medium-4">
      <figure class='image-left'>
      <a href="/" style="border-bottom: none;">
      	<img src="/img/rjh.png" alt="Portrait of the author" class='avatar' style="max-width: 50%;">
      </a>
  </figure>
  <p>
Rob&nbsp;J&nbsp;Hyndman is Professor of Statistics at <a href=https://www.monash.edu>Monash University</a>, Australia, and Editor-​​in-​​Chief of the <a href=https://ijf.forecasters.org>Inter­na­tional Jour­nal of Fore­cast­ing</a>.  </p>
    </div>
    <div class="column small-12 medium-4">
      
      <h4 id="contact">Contact</h4>
      <ul class="fa-ul">
	
	<li><i class="fa-li fa fa-university" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.monash.edu/business/econometrics-and-business-statistics">Department of Econometrics &amp; Business Statistics, Monash University, Clayton VIC 3800, Australia.</a></li>
	
	<li><i class="fa-li fa fa-envelope" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="mailto:Rob.Hyndman@monash.edu">Rob.Hyndman@monash.edu</a></li>
	
	<li><i class="fa-li fa fa-twitter" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://twitter.com/robjhyndman">@robjhyndman</a> on Twitter</li>
	
	<li><i class="fa-li fa fa-github-alt" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://github.com/robjhyndman/">robjhyndman</a> on GitHub</li>
	
	<li><i class="fa-li ai ai-google-scholar" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://scholar.google.com/citations?user=vamErfkAAAAJ">Google Scholar</a></li>
	
      </ul>
    </div>
    <div class="column small-12 medium-4">
      <h4>Subscribe</h4>
      <p><i><i class="fa fa-rss-square" style="color:#03396c;"></i> To receive updates from this site, you can subscribe to using an <a href="http://feeds.feedburner.com/ProfessorRobJHyndman">RSS feed reader</a> or <a href="https://feedburner.google.com/fb/a/mailverify?uri=ProfessorRobJHyndman">by email</a>.</i></p>
      <h4>Search</h4>
      <a id="searchsite">
	<form method="get" action="https://duckduckgo.com/">
	  <label for="search-field" class="show-for-sr">Search the site</label>
	  <input type="search" name="q" maxlength="255" placeholder="Search the site" id="search-field">
	  <input type="hidden" name="sites" value="https://robjhyndman.com"/>
	  <input type="hidden" name="k7" value="#faf8f8"/>
	  <input type="hidden" name="kj" value="#b33"/>
	  <input type="hidden" name="ky" value="#fafafa"/>
	  <input type="hidden" name="kx" value="b"/>
	  <input type="hidden" name="ko" value="-1"/>
	  <input type="hidden" name="k1" value="-1"/>
	  <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" />
	</form>
      </a>
    </div>
  </div>
  </span>
</footer>

    <div class="endofpage">
    <footer id="footer">
    <section class="wrapper small">Powered by <a href="http://gohugo.io">Hugo</a>
    and <a href="https://github.com/rstudio/blogdown">Blogdown</a>.
     &copy; <a href="https://robjhyndman.com">Rob&nbsp;J&nbsp;Hyndman</a> 1993&ndash;2018.
    </section>
    </footer>
    </div>

    <script src="/js/jquery.js"></script>
    <script src="/js/what-input.js"></script>
    <script src="/js/foundation.min.js"></script>
    <script src="/js/finite.js"></script>

    
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script>
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>

    
    


<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-5004894-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

 </body>
</html>
