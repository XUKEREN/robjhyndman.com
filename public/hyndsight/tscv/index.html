<!doctype html>
<html class="no-js" lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>Cross-validation for time series | Rob J Hyndman</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans|Merriweather" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/foundation.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/highlight.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/academicons.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/finite.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/kube.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/robjhyndman.css">
  </head>
  <body>
    <header>
      <nav class="nav-bar">
	
	  <div class="title-bar" data-responsive-toggle="site-menu" data-hide-for="medium">
	    <button class="site-hamburger" type="button" data-toggle>
	      <i class="fa fa-bars fa-lg" aria-hidden="true"></i>
	    </button>
	    <div class="title-bar-title site-title">
	      <a href="https://robjhyndman.com/"  style="color: #b3cde0">Rob J Hyndman</a>
	    </div>
	    <div class="title-bar-right pull-right">
	      


	    </div>
	  </div>

	  
	    <div class="top-bar" id="site-menu" >
	      <div class="top-bar-title show-for-medium site-title">
		<a href="https://robjhyndman.com/"  style="color: #b3cde0;">Rob J Hyndman</a>
	      </div>
	      <div class="top-bar-left">
		<ul class="menu vertical medium-horizontal">
		  
		  
		  <li><a href="https://robjhyndman.com/hyndsight/">Hyndsight blog</a></li>
		  
		  <li><a href="https://robjhyndman.com/publications/">Publications</a></li>
		  
		  <li><a href="https://robjhyndman.com/software/">Software</a></li>
		  
		  <li><a href="https://robjhyndman.com/seminars/">Seminars</a></li>
		  
		  <li><a href="https://robjhyndman.com/teaching/">Teaching</a></li>
		  
		  <li><a href="https://robjhyndman.com/research-team/">Research team</a></li>
		  
		  <li><a href="https://robjhyndman.com/about/">About</a></li>
		  
		</ul>
	      </div>
	      <div class="top-bar-right show-for-medium">
		


	      </div>
	    </div>
	  
	</nav>
    </header>
    <main>
      

<div class="wrapper">
<div class="units-row" style='margin-bottom: 0px;'>
<div class="unit-20">&nbsp;</div>
<div class="unit-60"><h1>Cross-validation for time series</h1></div>
</div>
<div class="units-row">
  <div class="unit-20 dateblock" style='text-align: right;'><h4 style='padding: .8ex 0px .8ex 0px;'><a href="https://robjhyndman.com/hyndsight">Hyndsight</a></h4>
      <div class="post-metadata">
  <span class="post-date">
    <time datetime="2016-12-05 12:43:57 &#43;0000 &#43;0000" itemprop="datePublished">5 December 2016</time>
  </span>
  
  
  
  <span class="post-tags">
    <p><i class="fa fa-tags"></i>
    
    <a class="post-tag" href="https://robjhyndman.com/categories/forecasting">forecasting</a>,
     
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/r">R</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/statistics">statistics</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/time-series">time series</a>
    
  </span>
  
  
</div>

    </div>
<div class="unit-60">

  

<p>I&rsquo;ve added a couple of new functions to the <a href="https://github.com/robjhyndman/forecast">forecast package for R</a> which implement two types of cross-validation for time series.<!-- more --></p>

<h3 id="k-fold-cross-validation-for-autoregression">K-fold cross-validation for autoregression</h3>

<p>The first is regular k-fold cross-validation for autoregressive models. Although cross-validation is sometimes not valid for time series models, it does work for autoregressions, which includes many machine learning approaches to time series. The theoretical background is provided in <a href="https://robjhyndman.com/publications/cv-time-series">Bergmeir, Hyndman and Koo (2015)</a>. So cross-validation can be applied to any model where the predictors are lagged values of the response variable.</p>

<p>This is implemented for NNAR models (neural network autoregressions) in R as follows:</p>

<pre><code>modelcv &lt;- CVar(lynx, k=5, lambda=0.15)
print(modelcv)
</code></pre>

<p>The output is a summary of the accuracy across folds:</p>

<pre><code>5-fold cross-validation
                  Mean          SD
ME        -32.88142801  98.0725227
RMSE      931.90966858 352.8705338
MAE       608.99488205 272.1244879
MPE       -17.84710226  15.2700638
MAPE       53.99760978  12.7264054
ACF1        0.04842174   0.1480883
Theil's U   0.82984737   0.1487229
</code></pre>

<p>The <code>CVar</code> function is rather limited at this stage, and will only handle cross-validation for models computed using <code>nnetar</code>. If there is enough interest, I might add more functionality at a later stage.</p>

<h3 id="time-series-cross-validation">Time series cross-validation</h3>

<p>In this procedure, there is a series of test sets, each consisting of a single observation. The corresponding training set consists only of observations that occurred <em>prior</em> to the observation that forms the test set. Thus, no future observations can be used in constructing the forecast. The following diagram illustrates the series of training and test sets, where the blue observations form the training sets, and the red observations form the test sets.</p>

<p><img src="https://robjhyndman.com/files/cv1-1.png" alt="cv1-1" /></p>

<p>The forecast accuracy is computed by averaging over the test sets. This procedure is sometimes known as “evaluation on a rolling forecasting origin” because the “origin” at which the forecast is based rolls forward in time.</p>

<p>With time series forecasting, one-step forecasts may not be as relevant as multi-step forecasts. In this case, the cross-validation procedure based on a rolling forecasting origin can be modified to allow multi-step errors to be used. Suppose that we are interested in models that produce good 4-step-ahead forecasts. Then the corresponding diagram is shown below.</p>

<p><img src="https://robjhyndman.com/files/cv4-1.png" alt="cv4-1" /></p>

<p>Time series cross validation is implemented with the <code>tsCV</code> function. In the following example, we compare the residual RMSE with the RMSE obtained via time series cross-validation.</p>

<pre><code>library(fpp)
e &lt;- tsCV(dj, rwf, drift=TRUE, h=1)
sqrt(mean(e^2, na.rm=TRUE))
## [1] 22.68249
sqrt(mean(residuals(rwf(dj, drift=TRUE))^2, na.rm=TRUE))
## [1] 22.49681
</code></pre>

<p>Here I apply a random walk with drift to the Dow-Jones index time series <code>dj</code>.  The first calculation implements a one-step time series cross-validation where the drift parameter is re-estimated at every forecast origin. The second calculation estimates the drift parameter once for the whole data set, and then computes the RMSE from the one-step forecasts. As expected, the RMSE from the residuals is smaller, as the corresponding “forecasts” are based on a model fitted to the entire data set, rather than being true forecasts.</p>

<p>The <code>tsCV</code> function is very general, and will work for any forecasting function that returns an object of class <code>forecast</code>. You don&rsquo;t even have to specify the minimum sample size for model fitting, as it will silently fit models beginning with a single observation, and return a missing value whenever the model cannot be estimated.</p>

<p>These functions are only on the <a href="https://github.com/robjhyndman/forecast">github version</a> for now, but will migrate to <a href="https://cran.r-project.org/package=forecast">CRAN</a> next time I release a new stable version.</p>


      <meta itemprop="wordCount" content="550">
      <meta itemprop="datePublished" content="2016-12-05">
      <meta itemprop="url" content="https://robjhyndman.com/hyndsight/tscv/">

<div class='sans' style="background: #dddddd; padding: 2em;">
<div style="padding-bottom: 1em" >
<div class="share-box">
  <ul class="share">
    <li>
      <a class="facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2frobjhyndman.com%2fhyndsight%2ftscv%2f" target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter" href="https://twitter.com/intent/tweet?text=Cross-validation%20for%20time%20series. https%3a%2f%2frobjhyndman.com%2fhyndsight%2ftscv%2f from @robjhyndman" target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2ftscv%2f&amp;title=Cross-validation%20for%20time%20series" target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo" href="http://service.weibo.com/share/share.php?url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2ftscv%2f&amp;title=Cross-validation%20for%20time%20series" target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email" href="mailto:?subject=Cross-validation%20for%20time%20series&amp;body=https%3a%2f%2frobjhyndman.com%2fhyndsight%2ftscv%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


</div>

    <ul class="pagination" role="navigation" aria-label="Pagination">
      
      <li class="arrow" aria-disabled="true"><a href="https://robjhyndman.com/hyndsight/isf-invited-sessions/">&laquo; <em>Previous<span class="show-for-sr"> page</span></em>: Invited sessions at the International Symposium on Forecasting</a></li>
      
      
      <li class="arrow" aria-disabled="true"><a href="https://robjhyndman.com/hyndsight/ijf-reject/"><em>Next<span class="show-for-sr"> page</span></em>: What is going on?&nbsp;&raquo;</a></li>
      
    </ul>
    <a href="https://robjhyndman.com/hyndsight/">All Hyndsight posts by date</a>
</div>

<span style='font-family: Carlito'>
 <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
              return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'researchtips';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</span>

  </div>
  </div></div>

    </main>
    <footer class="whatisthis">
  <hr class='separator'/>
  <span style="font-family: Carlito, sans; font-size: 0.9em; line-height: 1.05em;">
  <div class="row">
    <div class="column small-12 medium-4">
      <figure class='image-left'>
      <a href="https://robjhyndman.com/" style="border-bottom: none;">
      	<img src="https://robjhyndman.com/img/rjh.png" alt="Portrait of the author" class='avatar' style="max-width: 50%;">
      </a>
  </figure>
  <p>
Rob&nbsp;J&nbsp;Hyndman is Professor of Statistics at <a href=https://www.monash.edu>Monash University</a>, Australia, and Editor-​​in-​​Chief of the <a href=https://ijf.forecasters.org>Inter­na­tional Jour­nal of Fore­cast­ing</a>.  </p>
    </div>
    <div class="column small-12 medium-4">
      
      <h4 id="contact">Contact</h4>
      <ul class="fa-ul">
	
	<li><i class="fa-li fa fa-university" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.monash.edu/business/econometrics-and-business-statistics">Department of Econometrics &amp; Business Statistics, Monash University, Clayton VIC 3800, Australia.</a></li>
	
	<li><i class="fa-li fa fa-envelope" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="mailto:Rob.Hyndman@monash.edu">Rob.Hyndman@monash.edu</a></li>
	
	<li><i class="fa-li fa fa-twitter" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://twitter.com/robjhyndman">@robjhyndman</a> on Twitter</li>
	
	<li><i class="fa-li fa fa-github-alt" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://github.com/robjhyndman/">robjhyndman</a> on GitHub</li>
	
	<li><i class="fa-li ai ai-google-scholar" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://scholar.google.com/citations?user=vamErfkAAAAJ">Google Scholar</a></li>
	
      </ul>
    </div>
    <div class="column small-12 medium-4">
      <h4>Subscribe</h4>
      <p><i><i class="fa fa-rss-square" style="color:#03396c;"></i> To receive updates from this site, you can subscribe to using an <a href="http://feeds.feedburner.com/ProfessorRobJHyndman">RSS feed reader</a> or <a href="https://feedburner.google.com/fb/a/mailverify?uri=ProfessorRobJHyndman">by email</a>.</i></p>
      <h4>Search</h4>
      <a id="searchsite">
	<form method="get" action="https://duckduckgo.com/">
	  <label for="search-field" class="show-for-sr">Search the site</label>
	  <input type="search" name="q" maxlength="255" placeholder="Search the site" id="search-field">
	  <input type="hidden" name="sites" value="https://robjhyndman.com"/>
	  <input type="hidden" name="k7" value="#faf8f8"/>
	  <input type="hidden" name="kj" value="#b33"/>
	  <input type="hidden" name="ky" value="#fafafa"/>
	  <input type="hidden" name="kx" value="b"/>
	  <input type="hidden" name="ko" value="-1"/>
	  <input type="hidden" name="k1" value="-1"/>
	  <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" />
	</form>
      </a>
    </div>
  </div>
  </span>
</footer>

    <div class="endofpage">
    <footer id="footer">
    <section class="wrapper small">Powered by <a href="http://gohugo.io">Hugo</a>
    and <a href="https://github.com/rstudio/blogdown">Blogdown</a>.
     &copy; <a href="https://robjhyndman.com">Rob&nbsp;J&nbsp;Hyndman</a> 1993&ndash;2018.
    </section>
    </footer>
    </div>

    <script src="https://robjhyndman.com/js/jquery.js"></script>
    <script src="https://robjhyndman.com/js/what-input.js"></script>
    <script src="https://robjhyndman.com/js/foundation.min.js"></script>
    <script src="https://robjhyndman.com/js/finite.js"></script>

    
    <script src="https://robjhyndman.com/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5004894-1', 'auto');
ga('send', 'pageview');
</script>

 </body>
</html>
