<!doctype html>
<html class="no-js" lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>Thoughts on the Ljung-Box test | Rob J Hyndman</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans|Merriweather" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/foundation.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/highlight.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/academicons.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/finite.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/kube.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/robjhyndman.css">
</head>
  <body>
    <header>
      <nav class="nav-bar">
	
	  <div class="title-bar" data-responsive-toggle="site-menu" data-hide-for="medium">
	    <button class="site-hamburger" type="button" data-toggle>
	      <i class="fa fa-bars fa-lg" aria-hidden="true"></i>
	    </button>
	    <div class="title-bar-title site-title">
	      <a href="https://robjhyndman.com/"  style="color: #b3cde0">Rob J Hyndman</a>
	    </div>
	    <div class="title-bar-right pull-right">
	      


	    </div>
	  </div>

	  
	    <div class="top-bar" id="site-menu" >
	      <div class="top-bar-title show-for-medium site-title">
		<a href="https://robjhyndman.com/"  style="color: #b3cde0;">Rob J Hyndman</a>
	      </div>
	      <div class="top-bar-left">
		<ul class="menu vertical medium-horizontal">
		  
		  
		  <li><a href="https://robjhyndman.com/hyndsight/">Hyndsight blog</a></li>
		  
		  <li><a href="https://robjhyndman.com/publications/">Publications</a></li>
		  
		  <li><a href="https://robjhyndman.com/software/">Software</a></li>
		  
		  <li><a href="https://robjhyndman.com/seminars/">Seminars</a></li>
		  
		  <li><a href="https://robjhyndman.com/teaching/">Teaching</a></li>
		  
		  <li><a href="https://robjhyndman.com/research-team/">Research team</a></li>
		  
		  <li><a href="https://robjhyndman.com/about/">About</a></li>
		  
		</ul>
	      </div>
	      <div class="top-bar-right show-for-medium">
		


	      </div>
	    </div>
	  
	</nav>
    </header>
    <main>
      

<div class="wrapper">
<div class="units-row" style='margin-bottom: 0px;'>
<div class="unit-20">&nbsp;</div>
<div class="unit-60"><h1>Thoughts on the Ljung-Box test</h1></div>
</div>
<div class="units-row">
  <div class="unit-20 dateblock" style='text-align: right;'><h4 style='padding: .8ex 0px .8ex 0px;'><a href="https://robjhyndman.com/hyndsight">Hyndsight</a></h4>
      <div class="post-metadata">
  <span class="post-date">
    <time datetime="2014-01-24 03:54:34 &#43;0000 &#43;0000" itemprop="datePublished">24 January 2014</time>
  </span>
  
  
  
  <span class="post-tags">
    <p><i class="fa fa-tags"></i>
    
    <a class="post-tag" href="https://robjhyndman.com/categories/forecasting">forecasting</a>,
     
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/fpp">fpp</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/r">R</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/statistics">statistics</a>
    
  </span>
  
  
</div>

    </div>
<div class="unit-60">

  <p>It is common to use a Ljung-Box test to check that the residuals from a time series model resemble white noise. However, there is very little practical advice around about how to choose the number of lags for the test.</p>

<p>The Ljung-Box test was proposed by <a href="http://dx.doi.org/10.1093/biomet/65.2.297" target="_blank">Ljung and Box (Biometrika, 1978)</a>
and is based on the statistic
$$
Q^* = T(T+2)\sum_{k=}^h (T-k)^{-1}r_k^2
$$
where $T$ is the length of the time series, $r_k$ is the $k$th autocorrelation coefficient of the residuals, and $h$ is the number of lags to test. Large values of $Q^*$ indicate that there are significant autocorrelations in the residual series. It can be tested against a $\chi^2$ distribution with $h-K$ degrees of freedom where $K$ is the number of parameters estimated in the model.</p>

<p>In <a href="https://www.otexts.org/fpp/2/6">my forecasting textbook</a> with George Athanasopoulos, we recommended using $h=10$ for non-seasonal data and $h=2m$ for seasonal data, where $m$ is the period of seasonality. These suggestions were based on power considerations. We want to ensure that $h$ is large enough to capture any meaningful and troublesome correlations. For seasonal data, it is common to have correlations at multiples of the seasonal lag remaining in the residuals, so we wanted to include at least two seasonal lags.</p>

<p>I have not seen similar advice in other time series textbooks; most authors seem to ignore such practical considerations. Patrick Burns in a short <a href="http://lib.stat.cmu.edu/S/Spoetry/Working/ljungbox.pdf">online paper</a> suggests the rule $h\le 0.05T$ based on a simulation study in which he tests the uniform distribution of $p$-values from the test under the null hypothesis of Gaussian white noise.</p>

<p>I think the latter test is unnecessarily restrictive. In practice, we don&rsquo;t really need the $p$-values to be uniform. What we want is the probability of a p-value being less than the chosen level (say 5%) being equal to that level. That is, the distribution needs to be uniform around the chosen level, but it does not need to be uniform elsewhere.</p>

<p>I have done some simulations to see the effect of different values of $h$. For sample sizes of $T=20, 50,100$ and $1000$, I generated Gaussian white noise series, and computed the p-value from a Ljung-Box test for each generated time series. Then I tested the uniformity of the p-values using a Kolmogorov-Smirnov test (following the approach used by Patrick Burns). Here are the resulting KS p-values based on 10000 simulations for each sample size.</p>

<p><img class="aligncenter size-large wp-image-2370" alt="kspvalues" src="https://robjhyndman.com/files/kspvalues1.png" width="1024" /></p>

<p>Clearly, the p-values fail the uniformity test for all values of $h$ when $T=20$, and for all but a few values of $h$ when $T=50$ and $T=100$. Only when $T=1000$ do the p-values look uniform up to about $h=35$.</p>

<p>However, when we look at the actual size of the test, a different story emerges.</p>

<p><img class="aligncenter size-full wp-image-2369" alt="actualsize" src="https://robjhyndman.com/files/actualsize1.png" width="1024" /></p>

<p>The above figure shows the proportion of Ljung-Box p-values less than 0.05 (top line) and less than 0.01 (bottom line). This demonstrates that the actual size of the test tends to be larger than the nominal size except for small values of $h$. For $h=10$, the actual size is about 0.015 larger than the nominal size when $T=50$ and about 0.01 larger when $T=100$, which is not too bad. For $T=20$, values of $h$ up to about 5 give reasonably good results. For $T=1000$, even using $h=100$ gives results that are not too far away from the nominal size of the test.</p>

<p>This analysis suggests that my rule-of-thumb could be modified a little as follows:</p>

<ul>
<li>For non-seasonal time series, use $h=\min(10, T/5)$.</li>
<li>For seasonal time series, use $h=\min(2m, T/5)$.</li>
</ul>

<p>It also shows that you should not be too fussy about the boundary. Because the actual size is a little larger than the nominal size for these values of $h$, you should expect a few more failures of the test than 5%. Further, it is always worth remembering Box&rsquo;s own advice that &ldquo;All models are wrong, but some are useful.&rdquo; So we expect the residuals to fail this test when we have sufficient data. That just shows that the model has not perfectly captured the information in the data. The only question is whether you can come up with a better model. Sometimes that just isn&rsquo;t possible.</span></p>

<h1 id="r-code">R code</h1>

<p>In case any reader wants to play with some more simulations, here is my R code.</p>

<pre><code class="language-r echo=TRUE, eval=FALSE">lj &lt;- array(NA, c(4,10000,100))
size &lt;- c(20,50,100,1000)

for(i in 1:10000)
{
  for(k in 1:4)
  {
    x &lt;- rnorm(size[k])
    for(j in 1:min(100,size[k]))
      lj[k,i,j] &lt;- Box.test(x, type=&quot;Ljung-Box&quot;, lag=j)$p.value
  }
}

ks.pvalue &lt;- function(x)
{
  x &lt;- na.omit(x)
  if(length(x)&gt;1)
    return(ks.test(x, punif)$p.value)
  else
    return(NA)
}

testsize &lt;- apply(lj, c(1,3), FUN=ks.pvalue)

par(mfrow=c(2,2))
plot(1:20,testsize[1,1:20],type=&quot;l&quot;, xlab=&quot;Number of lags&quot;, main=&quot;T=20&quot;, ylab=&quot;KS p-value&quot;, ylim=c(0,1))
abline(h=0.05,col=&quot;gray&quot;)

plot(1:50,testsize[2,1:50], type=&quot;l&quot;, xlab=&quot;Number of lags&quot;, main=&quot;T=50&quot;, ylab=&quot;KS p-value&quot;, ylim=c(0,1))
abline(h=0.05,col=&quot;gray&quot;)

plot(1:100,testsize[3,1:100], type=&quot;l&quot;, xlab=&quot;Number of lags&quot;, main=&quot;T=100&quot;, ylab=&quot;KS p-value&quot;, ylim=c(0,1))
abline(h=0.05,col=&quot;gray&quot;)

plot(1:100,testsize[4,1:100], type=&quot;l&quot;, xlab=&quot;Number of lags&quot;, main=&quot;T=1000&quot;, ylab=&quot;KS p-value&quot;, ylim=c(0,1))
abline(h=0.05,col=&quot;gray&quot;)

pv&lt;- function(x, threshold=0.05)
{
  mean(x &lt; threshold, na.rm=TRUE)
}

testsize &lt;- apply(lj, c(1,3), FUN=pv)
testsize1 &lt;- apply(lj, c(1,3), FUN=pv, threshold=0.01)

par(mfrow=c(2,2))
plot(1:20,testsize[1,1:20],type=&quot;n&quot;, main=&quot;T=20&quot;, xlab=&quot;Number of lags&quot;, ylab=&quot;Actual size&quot;, ylim=c(0,0.12))
axis(2, at=seq(0,0.1,by=0.01))
abline(h=c(0.01,0.05),col=gray(0.6))
lines(1:20, testsize[1,1:20])
lines(1:20, testsize1[1,1:20])

plot(1:50,testsize[2,1:50], type=&quot;n&quot;, main=&quot;T=50&quot;, xlab=&quot;Number of lags&quot;, ylab=&quot;Actual size&quot;, ylim=c(0,0.12))
axis(2, at=seq(0,0.1,by=0.01))
abline(h=c(0.01,0.05),col=gray(0.6))
lines(1:50, testsize[2,1:50])
lines(1:50, testsize1[2,1:50])

plot(1:100,testsize[3,1:100], type=&quot;n&quot;, main=&quot;T=100&quot;, xlab=&quot;Number of lags&quot;, ylab=&quot;Actual size&quot;, ylim=c(0,0.12))
axis(2, at=seq(0,0.1,by=0.01))
abline(h=c(0.01,0.05),col=gray(0.6))
lines(1:100, testsize[3,1:100])
lines(1:100, testsize1[3,1:100])

plot(1:100,testsize[4,1:100], type=&quot;n&quot;, main=&quot;T=1000&quot;, xlab=&quot;Number of lags&quot;, ylab=&quot;Actual size&quot;, ylim=c(0,0.12))
axis(2, at=seq(0,0.1,by=0.01))
abline(h=c(0.01,0.05),col=gray(0.6))
lines(1:100, testsize[4,1:100])
lines(1:100, testsize1[4,1:100])
</code></pre>

<h1 id="reference">Reference:</h1>

<p><a href="http://dx.doi.org/10.1093/biomet/65.2.297">G. M. Ljung; G. E. P. Box (1978). &ldquo;On a Measure of a Lack of Fit in Time Series Models&rdquo;. <em>Biometrika</em>, <strong>65</strong>(2), 297–303.</a></p>

      <meta itemprop="wordCount" content="900">
      <meta itemprop="datePublished" content="2014-01-24">
      <meta itemprop="url" content="https://robjhyndman.com/hyndsight/ljung-box-test/">

<div class='sans' style="background: #dddddd; padding: 2em;">
<div style="padding-bottom: 1em" >
<div class="share-box">
  <ul class="share">
    <li>
      <a class="facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fljung-box-test%2f" target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter" href="https://twitter.com/intent/tweet?text=Thoughts%20on%20the%20Ljung-Box%20test. https%3a%2f%2frobjhyndman.com%2fhyndsight%2fljung-box-test%2f from @robjhyndman" target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fljung-box-test%2f&amp;title=Thoughts%20on%20the%20Ljung-Box%20test" target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo" href="http://service.weibo.com/share/share.php?url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fljung-box-test%2f&amp;title=Thoughts%20on%20the%20Ljung-Box%20test" target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email" href="mailto:?subject=Thoughts%20on%20the%20Ljung-Box%20test&amp;body=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fljung-box-test%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


</div>

    <ul class="pagination" role="navigation" aria-label="Pagination">
      
      <li class="arrow" aria-disabled="true"><a href="https://robjhyndman.com/hyndsight/postdoc/">&laquo; <em>Previous<span class="show-for-sr"> page</span></em>: Looking for a new post-doc</a></li>
      
      
      <li class="arrow" aria-disabled="true"><a href="https://robjhyndman.com/hyndsight/forecast5/"><em>Next<span class="show-for-sr"> page</span></em>: New in forecast 5.0&nbsp;&raquo;</a></li>
      
    </ul>
    <a href="https://robjhyndman.com/hyndsight/">All Hyndsight posts by date</a>
</div>

<span style='font-family: Carlito'>
 <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
              return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'researchtips';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</span>

  </div>
  </div></div>

    </main>
    <footer class="whatisthis">
  <hr class='separator'/>
  <span style="font-family: Carlito, sans; font-size: 0.9em; line-height: 1.05em;">
  <div class="row">
    <div class="column small-12 medium-4">
      <figure class='image-left'>
      <a href="https://robjhyndman.com/" style="border-bottom: none;">
      	<img src="https://robjhyndman.com/img/rjh.png" alt="Portrait of the author" class='avatar' style="max-width: 50%;">
      </a>
  </figure>
  <p>
Rob&nbsp;J&nbsp;Hyndman is Professor of Statistics at <a href=https://www.monash.edu>Monash University</a>, Australia, and Editor-​​in-​​Chief of the <a href=https://ijf.forecasters.org>Inter­na­tional Jour­nal of Fore­cast­ing</a>.  </p>
    </div>
    <div class="column small-12 medium-4">
      
      <h4 id="contact">Contact</h4>
      <ul class="fa-ul">
	
	<li><i class="fa-li fa fa-university" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.monash.edu/business/econometrics-and-business-statistics">Department of Econometrics &amp; Business Statistics, Monash University, Clayton VIC 3800, Australia.</a></li>
	
	<li><i class="fa-li fa fa-envelope" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="mailto:Rob.Hyndman@monash.edu">Rob.Hyndman@monash.edu</a></li>
	
	<li><i class="fa-li fa fa-twitter" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://twitter.com/robjhyndman">@robjhyndman</a> on Twitter</li>
	
	<li><i class="fa-li fa fa-github-alt" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://github.com/robjhyndman/">robjhyndman</a> on GitHub</li>
	
	<li><i class="fa-li ai ai-google-scholar" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://scholar.google.com/citations?user=vamErfkAAAAJ">Google Scholar</a></li>
	
      </ul>
    </div>
    <div class="column small-12 medium-4">
      <h4>Subscribe</h4>
      <p><i><i class="fa fa-rss-square" style="color:#03396c;"></i> To receive updates from this site, you can subscribe to using an <a href="http://feeds.feedburner.com/ProfessorRobJHyndman">RSS feed reader</a> or <a href="https://feedburner.google.com/fb/a/mailverify?uri=ProfessorRobJHyndman">by email</a>.</i></p>
      <h4>Search</h4>
      <a id="searchsite">
	<form method="get" action="https://duckduckgo.com/">
	  <label for="search-field" class="show-for-sr">Search the site</label>
	  <input type="search" name="q" maxlength="255" placeholder="Search the site" id="search-field">
	  <input type="hidden" name="sites" value="https://robjhyndman.com"/>
	  <input type="hidden" name="k7" value="#faf8f8"/>
	  <input type="hidden" name="kj" value="#b33"/>
	  <input type="hidden" name="ky" value="#fafafa"/>
	  <input type="hidden" name="kx" value="b"/>
	  <input type="hidden" name="ko" value="-1"/>
	  <input type="hidden" name="k1" value="-1"/>
	  <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" />
	</form>
      </a>
    </div>
  </div>
  </span>
</footer>

    <div class="endofpage">
    <footer id="footer">
    <section class="wrapper small">Powered by <a href="http://gohugo.io">Hugo</a>
    and <a href="https://github.com/rstudio/blogdown">Blogdown</a>.
     &copy; <a href="https://robjhyndman.com">Rob&nbsp;J&nbsp;Hyndman</a> 1993&ndash;2018.
    </section>
    </footer>
    </div>

    <script src="https://robjhyndman.com/js/jquery.js"></script>
    <script src="https://robjhyndman.com/js/what-input.js"></script>
    <script src="https://robjhyndman.com/js/foundation.min.js"></script>
    <script src="https://robjhyndman.com/js/finite.js"></script>

    
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script>
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>

    
    
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
    </script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML">
    </script>
    


<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-5004894-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

 </body>
</html>
