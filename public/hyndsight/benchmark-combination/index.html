<!doctype html>
<html class="no-js" lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>A useful forecast combination benchmark | Rob J Hyndman</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans|Merriweather" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/foundation.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/highlight.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/academicons.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/finite.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/kube.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/robjhyndman.css">
</head>
  <body>
    <header>
      <nav class="nav-bar">
	
	  <div class="title-bar" data-responsive-toggle="site-menu" data-hide-for="medium">
	    <button class="site-hamburger" type="button" data-toggle>
	      <i class="fa fa-bars fa-lg" aria-hidden="true"></i>
	    </button>
	    <div class="title-bar-title site-title">
	      <a href="https://robjhyndman.com/"  style="color: #b3cde0">Rob J Hyndman</a>
	    </div>
	    <div class="title-bar-right pull-right">
	      


	    </div>
	  </div>

	  
	    <div class="top-bar" id="site-menu" >
	      <div class="top-bar-title show-for-medium site-title">
		<a href="https://robjhyndman.com/"  style="color: #b3cde0;">Rob J Hyndman</a>
	      </div>
	      <div class="top-bar-left">
		<ul class="menu vertical medium-horizontal">
		  
		  
		  <li><a href="https://robjhyndman.com/hyndsight/">Hyndsight blog</a></li>
		  
		  <li><a href="https://robjhyndman.com/publications/">Publications</a></li>
		  
		  <li><a href="https://robjhyndman.com/software/">Software</a></li>
		  
		  <li><a href="https://robjhyndman.com/seminars/">Seminars</a></li>
		  
		  <li><a href="https://robjhyndman.com/teaching/">Teaching</a></li>
		  
		  <li><a href="https://robjhyndman.com/research-team/">Research team</a></li>
		  
		  <li><a href="https://robjhyndman.com/about/">About</a></li>
		  
		</ul>
	      </div>
	      <div class="top-bar-right show-for-medium">
		


	      </div>
	    </div>
	  
	</nav>
    </header>
    <main>
      

<div class="wrapper">
<div class="units-row" style='margin-bottom: 0px;'>
<div class="unit-20">&nbsp;</div>
<div class="unit-60"><h1>A useful forecast combination benchmark</h1></div>
</div>
<div class="units-row">
  <div class="unit-20 dateblock" style='text-align: right;'><h4 style='padding: .8ex 0px .8ex 0px;'><a href="https://robjhyndman.com/hyndsight">Hyndsight</a></h4>
      <div class="post-metadata">
  <span class="post-date">
    <time datetime="2018-06-24 00:00:00 &#43;0000 UTC" itemprop="datePublished">24 June 2018</time>
  </span>
  
  
  
  <span class="post-tags">
    <p><i class="fa fa-tags"></i>
    
    <a class="post-tag" href="https://robjhyndman.com/categories/forecasting">forecasting</a>,
     
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/time-series">time series</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/r">R</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/conferences">conferences</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/data-science">data science</a>
    
  </span>
  
  
</div>

    </div>
<div class="unit-60">

  <p><a href="https://robjhyndman.com/hyndsight/benchmarks">Forecasting benchmarks</a> are very important when testing new forecasting methods, to see how well they perform against some simple alternatives. Every week I get sent papers proposing new forecasting methods that fail to do better than even the simplest benchmark. They are rejected without review.</p>
<p><a href="https://otexts.org/fpp2/simple-methods.html">Typical benchmarks</a> include the naïve method (especially for finance and economic data), the seasonal naïve method (for seasonal data), an automatically selected <a href="https://otexts.org/fpp2/ets.html">ETS model</a>, and an automatically selected <a href="https://otexts.org/fpp2/arima.html">ARIMA model</a>. These are easily obtained using the <code>naive()</code>, <code>snaive()</code>, <code>ets()</code> and <code>auto.arima()</code> functions in the forecast package. Note that the seasonal naïve method is equivalent to the naïve method for annual data (or any other data with frequency=1).</p>
<p>Another benchmark worth considering is the Theta method which did very well in the M3 forecasting competition. The <code>thetaf()</code> function provides a convenient implementation.</p>
<p>At the <a href="http://isf.forecasters.org">International Symposium on Forecasting</a> held in Boulder last week, <a href="https://forecasters.org/blog/2017/01/30/member-profile-srihari-jaganathan/">Srihari Jaganathan</a> proposed that a simple average of these forecasts should be used as a standard forecast combination benchmark. This is a good idea as it is very easy to do, relatively fast to compute, and often provides an excellent forecast. (For other combinations, the <a href="https://cran.r-project.org/package=forecastHybrid">forecastHybrid</a> package might be useful.)</p>
<p>In this post, I will test various subsets of the four benchmark methods mentioned above to see which performs best. Here is some R code to compute all possible subset combinations from these four benchmarks. That gives 15 (<span class="math inline">\(=2^4-1\)</span>) possible combinations.</p>
<p>The code is general enough that it is easy to add additional methods if anyone wants to include other possible benchmark methods. Just name them with a unique letter in the following function; no other code in this post needs to be changed.</p>
<pre class="r"><code>benchmarks &lt;- function(y, h) {
  require(forecast)
  # Compute four benchmark methods
  fcasts &lt;- rbind(
    N = snaive(y, h)$mean,
    E = forecast(ets(y), h)$mean,
    A = forecast(auto.arima(y), h)$mean,
    T = thetaf(y, h)$mean)
  colnames(fcasts) &lt;- seq(h)
  method_names &lt;- rownames(fcasts)
  # Compute all possible combinations
  method_choice &lt;- rep(list(0:1), length(method_names))
  names(method_choice) &lt;- method_names
  combinations &lt;- expand.grid(method_choice) %&gt;% tail(-1) %&gt;% as.matrix()
  # Construct names for all combinations
  for (i in seq(NROW(combinations))) {
    rownames(combinations)[i] &lt;- paste0(method_names[which(combinations[i, ] &gt; 0)], 
      collapse = &quot;&quot;)
  }
  # Compute combination weights
  combinations &lt;- sweep(combinations, 1, rowSums(combinations), FUN = &quot;/&quot;)
  # Compute combinations of forecasts
  return(combinations %*% fcasts)
}</code></pre>
<p>Let’s try it out on the M3 competition data.</p>
<pre class="r"><code>library(Mcomp)
library(tidyverse)
# Compute &quot;symmetric&quot; percentage errors and scaled errors
errors &lt;- map(M3, function(u) {
  train &lt;- u$x
  test &lt;- u$xx
  f &lt;- benchmarks(train, u$h)
  error &lt;- -sweep(f, 2, test)
  pcerror &lt;- (200 * abs(error) / sweep(abs(f), 2, abs(test), FUN = &quot;+&quot;)) %&gt;%
    as_tibble() %&gt;%
    mutate(Method = rownames(f)) %&gt;%
    gather(key = h, value = sAPE, -Method)
  scalederror &lt;- (abs(error) / mean(abs(diff(train, lag = frequency(train))))) %&gt;%
    as_tibble() %&gt;%
    mutate(Method = rownames(f)) %&gt;%
    gather(key = h, value = ASE, -Method)
  return(list(pcerror = pcerror, scalederror = scalederror))
})
# Construct a tibble with all results
M3errors &lt;- tibble(
    Series = names(M3),
    Period = map_chr(M3, &quot;period&quot;),
    se = map(errors, &quot;scalederror&quot;),
    pce = map(errors, &quot;pcerror&quot;)) %&gt;%
  unnest() %&gt;%
  select(-h1, -Method1) %&gt;%
  mutate(h = as.integer(h), 
         Period = factor(str_to_title(Period), 
                         levels = c(&quot;Monthly&quot;,&quot;Quarterly&quot;,&quot;Yearly&quot;,&quot;Other&quot;)))</code></pre>
<p>We need to average the accuracy measures for each period, horizon and method.</p>
<pre class="r"><code>accuracy &lt;- M3errors %&gt;%
  group_by(Period, Method, h) %&gt;%
  summarize(MASE=mean(ASE), sMAPE=mean(sAPE)) %&gt;%
  ungroup()</code></pre>
<p>To keep the table of results of a manageable size, I have summarised the accuracy statistics over all forecast horizons, and included only the best combination approach plus the original benchmark methods. The table is ordered by MASE value with the best method at the top for each period.</p>
<pre class="r"><code># Find names of original methods
original_methods &lt;- unique(accuracy[[&quot;Method&quot;]])
original_methods &lt;- original_methods[str_length(original_methods)==1L]
# Compute summary table of accuracy measures
accuracy_table &lt;- accuracy %&gt;%
  group_by(Method,Period) %&gt;%
  summarise(
    sMAPE = mean(sMAPE, na.rm = TRUE),
    MASE = mean(MASE, na.rm = TRUE) ) %&gt;%
  arrange(MASE) %&gt;% ungroup()
best &lt;- accuracy_table %&gt;% filter(MASE==min(MASE))
accuracy_table &lt;- accuracy_table %&gt;%
  filter(Method %in% original_methods | Method %in% best$Method) %&gt;%
  arrange(Period, MASE) %&gt;%
  select(Period, Method, sMAPE, MASE)
knitr::kable(accuracy_table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Period</th>
<th align="left">Method</th>
<th align="right">sMAPE</th>
<th align="right">MASE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Monthly</td>
<td align="left">EAT</td>
<td align="right">13.54</td>
<td align="right">0.828</td>
</tr>
<tr class="even">
<td align="left">Monthly</td>
<td align="left">T</td>
<td align="right">13.86</td>
<td align="right">0.864</td>
</tr>
<tr class="odd">
<td align="left">Monthly</td>
<td align="left">E</td>
<td align="right">14.14</td>
<td align="right">0.865</td>
</tr>
<tr class="even">
<td align="left">Monthly</td>
<td align="left">A</td>
<td align="right">15.03</td>
<td align="right">0.867</td>
</tr>
<tr class="odd">
<td align="left">Monthly</td>
<td align="left">N</td>
<td align="right">17.23</td>
<td align="right">1.146</td>
</tr>
<tr class="even">
<td align="left">Quarterly</td>
<td align="left">EAT</td>
<td align="right">9.01</td>
<td align="right">1.064</td>
</tr>
<tr class="odd">
<td align="left">Quarterly</td>
<td align="left">T</td>
<td align="right">9.20</td>
<td align="right">1.117</td>
</tr>
<tr class="even">
<td align="left">Quarterly</td>
<td align="left">E</td>
<td align="right">9.68</td>
<td align="right">1.170</td>
</tr>
<tr class="odd">
<td align="left">Quarterly</td>
<td align="left">A</td>
<td align="right">10.03</td>
<td align="right">1.190</td>
</tr>
<tr class="even">
<td align="left">Quarterly</td>
<td align="left">N</td>
<td align="right">11.06</td>
<td align="right">1.425</td>
</tr>
<tr class="odd">
<td align="left">Yearly</td>
<td align="left">EAT</td>
<td align="right">16.04</td>
<td align="right">2.690</td>
</tr>
<tr class="even">
<td align="left">Yearly</td>
<td align="left">T</td>
<td align="right">16.76</td>
<td align="right">2.774</td>
</tr>
<tr class="odd">
<td align="left">Yearly</td>
<td align="left">E</td>
<td align="right">17.00</td>
<td align="right">2.860</td>
</tr>
<tr class="even">
<td align="left">Yearly</td>
<td align="left">A</td>
<td align="right">17.12</td>
<td align="right">2.964</td>
</tr>
<tr class="odd">
<td align="left">Yearly</td>
<td align="left">N</td>
<td align="right">17.88</td>
<td align="right">3.172</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="left">EAT</td>
<td align="right">4.30</td>
<td align="right">1.805</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="left">E</td>
<td align="right">4.37</td>
<td align="right">1.814</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="left">A</td>
<td align="right">4.46</td>
<td align="right">1.832</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="left">T</td>
<td align="right">4.92</td>
<td align="right">2.271</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="left">N</td>
<td align="right">6.30</td>
<td align="right">3.089</td>
</tr>
</tbody>
</table>
<p>The best performing benchmark method is EAT – a combination of an ETS model, an ARIMA model and the Theta method.</p>
<p>Next, we can plot the accuracy statistics against the forecast horizon. The legend has been ordered to correspond roughly to the order of the series in the MASE plots.</p>
<pre class="r"><code>order &lt;- accuracy_table %&gt;% group_by(Method) %&gt;% 
  summarise(MASE = mean(MASE)) %&gt;% arrange(MASE) %&gt;%
  pull(&quot;Method&quot;) %&gt;% rev()
accuracy %&gt;%
  gather(key = &quot;Measure&quot;, value = &quot;accuracy&quot;, sMAPE, MASE) %&gt;%
  filter(Method %in% unique(accuracy_table$Method)) %&gt;%
  mutate(Method = factor(Method, levels=order)) %&gt;%
  ggplot(aes(x = h, y = accuracy), group = Method) +
    geom_line(aes(col = Method)) + 
    facet_grid(rows = vars(Measure), cols=vars(Period), scale = &quot;free&quot;) +
    xlab(&quot;Forecast horizon&quot;) + ylab(&quot;Forecast accuracy&quot;)</code></pre>
<p><img src="https://robjhyndman.com/hyndsight/2018-06-combination-benchmark_files/figure-html/plots-1.png" width="960" /></p>
<p>From the graph we can see that the EAT combination works well for all periods and almost all horizons. To finish, here is a function which produces the EAT combination benchmark as a forecast object.</p>
<pre class="r"><code>eat_combination &lt;- function(y, h = ifelse(frequency(y) &gt; 1, 2*frequency(y), 10)) {
  require(forecast)
  fets &lt;- forecast(ets(y), h)
  farima &lt;- forecast(auto.arima(y), h)
  ftheta &lt;- thetaf(y, h)
  comb &lt;- fets
  comb$mean &lt;-(fets$mean + farima$mean + ftheta$mean)/3
  comb$method &lt;- &quot;ETS-ARIMA-Theta Combination&quot;
  return(comb)
}
USAccDeaths %&gt;% eat_combination() %&gt;% autoplot()</code></pre>
<p><img src="https://robjhyndman.com/hyndsight/2018-06-combination-benchmark_files/figure-html/eat-1.png" width="672" /></p>
<p>The prediction intervals shown are simply those from the ETS model. Combining prediction intervals is more difficult, and I’ll leave that to another post.</p>


      <meta itemprop="wordCount" content="953">
      <meta itemprop="datePublished" content="2018-06-24">
      <meta itemprop="url" content="https://robjhyndman.com/hyndsight/benchmark-combination/">

<div class='sans' style="background: #dddddd; padding: 2em;">
<div style="padding-bottom: 1em" >
<div class="share-box">
  <ul class="share">
    <li>
      <a class="facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fbenchmark-combination%2f" target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter" href="https://twitter.com/intent/tweet?text=A%20useful%20forecast%20combination%20benchmark. https%3a%2f%2frobjhyndman.com%2fhyndsight%2fbenchmark-combination%2f from @robjhyndman" target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fbenchmark-combination%2f&amp;title=A%20useful%20forecast%20combination%20benchmark" target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo" href="http://service.weibo.com/share/share.php?url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fbenchmark-combination%2f&amp;title=A%20useful%20forecast%20combination%20benchmark" target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email" href="mailto:?subject=A%20useful%20forecast%20combination%20benchmark&amp;body=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fbenchmark-combination%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


</div>

    <ul class="pagination" role="navigation" aria-label="Pagination">
      
      <li class="arrow" aria-disabled="true"><a href="https://robjhyndman.com/hyndsight/forecasting-nyc-2018/">&laquo; <em>Previous<span class="show-for-sr"> page</span></em>: Forecasting in NYC: 25-27 June 2018</a></li>
      
      
    </ul>
    <a href="https://robjhyndman.com/hyndsight/">All Hyndsight posts by date</a>
</div>

<span style='font-family: Carlito'>
 <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
              return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'researchtips';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</span>

  </div>
  </div></div>

    </main>
    <footer class="whatisthis">
  <hr class='separator'/>
  <span style="font-family: Carlito, sans; font-size: 0.9em; line-height: 1.05em;">
  <div class="row">
    <div class="column small-12 medium-4">
      <figure class='image-left'>
      <a href="https://robjhyndman.com/" style="border-bottom: none;">
      	<img src="https://robjhyndman.com/img/rjh.png" alt="Portrait of the author" class='avatar' style="max-width: 50%;">
      </a>
  </figure>
  <p>
Rob&nbsp;J&nbsp;Hyndman is Professor of Statistics at <a href=https://www.monash.edu>Monash University</a>, Australia, and Editor-​​in-​​Chief of the <a href=https://ijf.forecasters.org>Inter­na­tional Jour­nal of Fore­cast­ing</a>.  </p>
    </div>
    <div class="column small-12 medium-4">
      
      <h4 id="contact">Contact</h4>
      <ul class="fa-ul">
	
	<li><i class="fa-li fa fa-university" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.monash.edu/business/econometrics-and-business-statistics">Department of Econometrics &amp; Business Statistics, Monash University, Clayton VIC 3800, Australia.</a></li>
	
	<li><i class="fa-li fa fa-envelope" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="mailto:Rob.Hyndman@monash.edu">Rob.Hyndman@monash.edu</a></li>
	
	<li><i class="fa-li fa fa-twitter" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://twitter.com/robjhyndman">@robjhyndman</a> on Twitter</li>
	
	<li><i class="fa-li fa fa-github-alt" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://github.com/robjhyndman/">robjhyndman</a> on GitHub</li>
	
	<li><i class="fa-li ai ai-google-scholar" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://scholar.google.com/citations?user=vamErfkAAAAJ">Google Scholar</a></li>
	
      </ul>
    </div>
    <div class="column small-12 medium-4">
      <h4>Subscribe</h4>
      <p><i><i class="fa fa-rss-square" style="color:#03396c;"></i> To receive updates from this site, you can subscribe to using an <a href="http://feeds.feedburner.com/ProfessorRobJHyndman">RSS feed reader</a> or <a href="https://feedburner.google.com/fb/a/mailverify?uri=ProfessorRobJHyndman">by email</a>.</i></p>
      <h4>Search</h4>
      <a id="searchsite">
	<form method="get" action="https://duckduckgo.com/">
	  <label for="search-field" class="show-for-sr">Search the site</label>
	  <input type="search" name="q" maxlength="255" placeholder="Search the site" id="search-field">
	  <input type="hidden" name="sites" value="https://robjhyndman.com"/>
	  <input type="hidden" name="k7" value="#faf8f8"/>
	  <input type="hidden" name="kj" value="#b33"/>
	  <input type="hidden" name="ky" value="#fafafa"/>
	  <input type="hidden" name="kx" value="b"/>
	  <input type="hidden" name="ko" value="-1"/>
	  <input type="hidden" name="k1" value="-1"/>
	  <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" />
	</form>
      </a>
    </div>
  </div>
  </span>
</footer>

    <div class="endofpage">
    <footer id="footer">
    <section class="wrapper small">Powered by <a href="http://gohugo.io">Hugo</a>
    and <a href="https://github.com/rstudio/blogdown">Blogdown</a>.
     &copy; <a href="https://robjhyndman.com">Rob&nbsp;J&nbsp;Hyndman</a> 1993&ndash;2018.
    </section>
    </footer>
    </div>

    <script src="https://robjhyndman.com/js/jquery.js"></script>
    <script src="https://robjhyndman.com/js/what-input.js"></script>
    <script src="https://robjhyndman.com/js/foundation.min.js"></script>
    <script src="https://robjhyndman.com/js/finite.js"></script>

    
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script>
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>

    
    
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
    </script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML">
    </script>
    


<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-5004894-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

 </body>
</html>
