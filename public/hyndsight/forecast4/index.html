<!doctype html>
<html class="no-js" lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>New in forecast 4.0 | Rob J Hyndman</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans|Merriweather" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/foundation.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/highlight.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/academicons.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/finite.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/kube.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/robjhyndman.css">
</head>
  <body>
    <header>
      <nav class="nav-bar">
	
	  <div class="title-bar" data-responsive-toggle="site-menu" data-hide-for="medium">
	    <button class="site-hamburger" type="button" data-toggle>
	      <i class="fa fa-bars fa-lg" aria-hidden="true"></i>
	    </button>
	    <div class="title-bar-title site-title">
	      <a href="https://robjhyndman.com/"  style="color: #b3cde0">Rob J Hyndman</a>
	    </div>
	    <div class="title-bar-right pull-right">
	      


	    </div>
	  </div>

	  
	    <div class="top-bar" id="site-menu" >
	      <div class="top-bar-title show-for-medium site-title">
		<a href="https://robjhyndman.com/"  style="color: #b3cde0;">Rob J Hyndman</a>
	      </div>
	      <div class="top-bar-left">
		<ul class="menu vertical medium-horizontal">
		  
		  
		  <li><a href="https://robjhyndman.com/hyndsight/">Hyndsight blog</a></li>
		  
		  <li><a href="https://robjhyndman.com/publications/">Publications</a></li>
		  
		  <li><a href="https://robjhyndman.com/software/">Software</a></li>
		  
		  <li><a href="https://robjhyndman.com/seminars/">Seminars</a></li>
		  
		  <li><a href="https://robjhyndman.com/teaching/">Teaching</a></li>
		  
		  <li><a href="https://robjhyndman.com/research-team/">Research team</a></li>
		  
		  <li><a href="https://robjhyndman.com/about/">About</a></li>
		  
		</ul>
	      </div>
	      <div class="top-bar-right show-for-medium">
		


	      </div>
	    </div>
	  
	</nav>
    </header>
    <main>
      

<div class="wrapper">
<div class="units-row" style='margin-bottom: 0px;'>
<div class="unit-20">&nbsp;</div>
<div class="unit-60"><h1>New in forecast 4.0</h1></div>
</div>
<div class="units-row">
  <div class="unit-20 dateblock" style='text-align: right;'><h4 style='padding: .8ex 0px .8ex 0px;'><a href="https://robjhyndman.com/hyndsight">Hyndsight</a></h4>
      <div class="post-metadata">
  <span class="post-date">
    <time datetime="2012-12-03 03:53:53 &#43;0000 &#43;0000" itemprop="datePublished">3 December 2012</time>
  </span>
  
  
  
  <span class="post-tags">
    <p><i class="fa fa-tags"></i>
    
    <a class="post-tag" href="https://robjhyndman.com/categories/computing">computing</a>,
     
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/forecasting">forecasting</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/r">R</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/statistics">statistics</a>
    
  </span>
  
  
</div>

    </div>
<div class="unit-60">

  <p>A few days ago I released version 4.0 of the <a href="http://cran.r-project.org/web/packages/forecast/">forecast package for R</a>. There were quite a few changes and new features, so I thought it deserved a new version number. I keep a list of changes in the <a href="https://cran.r-project.org/web/packages/forecast/news.html">Changelog</a> for the package, but I doubt that many people look at it. So for the record, here are the most important changes to the forecast package made since <a href="https://robjhyndman.com/hyndsight/forecast3/">v3.0 was released</a>.<!-- more --></p>
<div id="exponential-smoothing" class="section level3">
<h3>Exponential smoothing</h3>
<p>The <code>ets()</code> function handles exponential smoothing in the ETS framework, but for teaching purposes it is sometimes useful to discuss a more traditional implementation that does not involve optimizing the initial values. The <code>HoltWinters()</code> function in the <code>stats</code> package attempts to do this, although the initialization used for the Holt and Holt-Winters methods is non-standard, making it unsuitable for teaching.</p>
<p>Consequently, Iâ€™ve now modified the <code>ses()</code>, <code>holt()</code> and <code>hw()</code> functions to allow both traditional heuristic initialization and ETS-style optimization of initial states. These functions also now allow damped trend and multiplicative trend.</p>
</div>
<div id="multiple-seasonality-and-bats-and-tbats-models" class="section level3">
<h3>Multiple seasonality and BATS and TBATS models</h3>
<p>Time series with multiple seasonal patterns (e.g., hourly data that contains a daily pattern, weekly pattern and an annual pattern) now have their own model class <code>msts</code>. This is useful when plotting the data, and in using the <code>dshw()</code> double seasonal Holt-Winters function for example.</p>
<p>The BATS and TBATS models (fitted using <code>bats()</code> and <code>tbats()</code>) also handle multiple seasonalities as well as complex seasonalities (such as non-integer seasonality, non-nested seasonality and large period seasonality). The models are in the exponential-smoothing framework and were proposed by <a href="https://robjhyndman.com/publications/complex-seasonality/">De Livera, Hyndman and Snyder (JASA 2011)</a>.</p>
<p>BATS and TBATS models allow a form of time series decomposition, and so the fitted objects can now plotted in the same way as other decomposition objects (e.g., <code>stl</code> objects).</p>
<p>These models are quite computationally intensive, and so the functions will use parallel processing when it is available.</p>
</div>
<div id="auto.arima" class="section level3">
<h3>auto.arima()</h3>
<p>This is probably the most popular function in the package, and I am always looking at ways to speed it up and improve the results.</p>
<ul>
<li>Default model selection has been switched from AIC to AICc (the bias-corrected form of AIC) which may affect model selection for very short time series.</li>
<li>The maximum orders are now restricted to less than 1/3 of the length of the data.</li>
<li>Parallel processing is used where possible when <code>stepwise=FALSE</code>.</li>
</ul>
</div>
<div id="accuracy-calculations" class="section level3">
<h3>Accuracy calculations</h3>
<p>The <code>accuracy</code> function now works with both time series forecasts and cross-sectional forecasts.</p>
<p>The MASE for seasonal time series is now defined using seasonal naive forecasts for the in-sample scaling. The MASE for cross-sectional forecasts is defined using the mean forecasts for in-sample scaling. This is consistent with <a href="http://otexts.org/fpp/2/5/">my new book</a>.</p>
</div>
<div id="neural-network-ar-models" class="section level3">
<h3>Neural network AR models</h3>
<p>A new experimental function <code>nnetar</code> has been introduced to fit a neural network with lagged values of the time series as inputs. It is a feed-forward network with one hidden layer, specified using the notation NNAR(<span class="math inline">\(p,k\)</span>) to indicate there are <span class="math inline">\(p\)</span> lagged inputs and <span class="math inline">\(k\)</span> nodes in the hidden layer. For example, a NNAR(9,5) model is a neural network with the last nine observations <span class="math inline">\((y\_{t-1},y\_{t-2},\dots,y\_{t-9}\)</span>) used as inputs to forecast the output <span class="math inline">\(y\_t\)</span>, and with five neurons in the hidden layer. A NNAR(<span class="math inline">\(p,0\)</span>) model is equivalent to an ARIMA(<span class="math inline">\(p,0,0\)</span>) model but without the restrictions on the parameters to ensure stationarity.</p>
<p>With seasonal data, it is useful to also add the last observed values from the same season as inputs. For example, an NNAR(3,1,2)<span class="math inline">\(\_{12}\)</span> model has inputs <span class="math inline">\(y\_{t-1}\)</span>, <span class="math inline">\(y\_{t-2}\)</span>, <span class="math inline">\(y\_{t-3}\)</span> and <span class="math inline">\(y\_{t-12}\)</span>, and two neurons in the hidden layer. More generally, an NNAR(<span class="math inline">\(p,P,k\)</span>)<span class="math inline">\(\_m\)</span> model has inputs <span class="math inline">\((y\_{t-1},y\_{t-2},\dots,y\_{t-p},y\_{t-m},y\_{t-2m},y_{t-Pm})\)</span> and <span class="math inline">\(k\)</span> neurons in the hidden layer. A NNAR(<span class="math inline">\(p,P,0\)</span>)<span class="math inline">\(\_m\)</span> model is equivalent to an ARIMA(<span class="math inline">\(p,0,0\)</span>)(<span class="math inline">\(P,0,0\)</span>)<span class="math inline">\(_m\)</span> model but without the restrictions on the parameters to ensure stationarity.</p>
<p>The <code>nnetar()</code> function fits an NNAR(<span class="math inline">\(p,P,k\)</span>)<span class="math inline">\(_m\)</span> model. If the values of <span class="math inline">\(p\)</span> and <span class="math inline">\(P\)</span> are not specified, they are automatically selected. For non-seasonal time series, the default is the optimal number of lags (according to the AIC) for a linear AR(<span class="math inline">\(p\)</span>) model. For seasonal time series, the default values are <span class="math inline">\(P=1\)</span> and <span class="math inline">\(p\)</span> is chosen from the optimal linear model fitted to the seasonally adjusted data. If <span class="math inline">\(k\)</span> is not specified, it is set to <span class="math inline">\(k=(p+P+1)/2\)</span> (rounded to the nearest integer).</p>
<p>By default, 25 networks with random starting values are trained and their predictions averaged.</p>
<p>Like many of the functions in the forecast package, the default arguments usually give reasonably good forecasts without the user needing to know much. For example:</p>
<pre class="r"><code>fit &lt;- nnetar(lynx)
plot(forecast(fit,h=20))</code></pre>
<p><img src="https://robjhyndman.com/hyndsight/2012-12-03-forecast4_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>Because random starting values are used, the forecasts will be slightly different each time the function is called.</p>
<p>It is possibly to compute prediction intervals from NNAR models via simulation, but I have not yet implemented this. The function will only give point forecasts for now.</p>
</div>
<div id="new-default-colors-for-forecast-plots" class="section level3">
<h3>New default colors for forecast plots</h3>
<p>The old yellow and orange colors have been replaced by shades of blue-grey which are a little easier on the eye. The darker the color, the higher the density. Here is an example with 80% and 95% prediction intervals.</p>
<pre class="r"><code>library(fpp)</code></pre>
<pre class="r"><code>fit &lt;- Arima(euretail, order=c(0,1,3), seasonal=c(0,1,1))
plot(forecast(fit,h=12))</code></pre>
<p><img src="https://robjhyndman.com/hyndsight/2012-12-03-forecast4_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="future-development" class="section level3">
<h3>Future development</h3>
<p>Earlier this year I started using the package for an undergraduate forecasting class which gave it a good work-out, and Iâ€™m also using it as the basis of <a href="http://otexts.org/fpp/">my new book</a> with George Athanasopoulos. As a result, a lot of new functionality has been added, and lots of bugs have been discovered and fixed.</p>
<p>The process is continuing and I have lots of ideas I want to implement, and no doubt more bugs will be discovered. The development of the forecast package is now <a href="http://github.com/robjhyndman/forecast">maintained on github</a> where you can see what is in development and report any new problems. Please let me know if you find anything you think is an error, or if you have a suggestion.</p>
</div>


      <meta itemprop="wordCount" content="960">
      <meta itemprop="datePublished" content="2012-12-03">
      <meta itemprop="url" content="https://robjhyndman.com/hyndsight/forecast4/">

<div class='sans' style="background: #dddddd; padding: 2em;">
<div style="padding-bottom: 1em" >
<div class="share-box">
  <ul class="share">
    <li>
      <a class="facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fforecast4%2f" target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter" href="https://twitter.com/intent/tweet?text=New%20in%20forecast%204.0. https%3a%2f%2frobjhyndman.com%2fhyndsight%2fforecast4%2f from @robjhyndman" target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fforecast4%2f&amp;title=New%20in%20forecast%204.0" target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo" href="http://service.weibo.com/share/share.php?url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fforecast4%2f&amp;title=New%20in%20forecast%204.0" target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email" href="mailto:?subject=New%20in%20forecast%204.0&amp;body=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fforecast4%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


</div>

    <ul class="pagination" role="navigation" aria-label="Pagination">
      
      <li class="arrow" aria-disabled="true"><a href="https://robjhyndman.com/hyndsight/makefiles/">&laquo; <em>Previous<span class="show-for-sr"> page</span></em>: Makefiles for R/LaTeX projects</a></li>
      
      
      <li class="arrow" aria-disabled="true"><a href="https://robjhyndman.com/hyndsight/ysc2013/"><em>Next<span class="show-for-sr"> page</span></em>: Man vs Wild Data&nbsp;&raquo;</a></li>
      
    </ul>
    <a href="https://robjhyndman.com/hyndsight/">All Hyndsight posts by date</a>
</div>

<span style='font-family: Carlito'>
 <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
              return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'researchtips';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</span>

  </div>
  </div></div>

    </main>
    <footer class="whatisthis">
  <hr class='separator'/>
  <span style="font-family: Carlito, sans; font-size: 0.9em; line-height: 1.05em;">
  <div class="row">
    <div class="column small-12 medium-4">
      <figure class='image-left'>
      <a href="https://robjhyndman.com/" style="border-bottom: none;">
      	<img src="https://robjhyndman.com/img/rjh.png" alt="Portrait of the author" class='avatar' style="max-width: 50%;">
      </a>
  </figure>
  <p>
Rob&nbsp;J&nbsp;Hyndman is Professor of Statistics at <a href=https://www.monash.edu>Monash University</a>, Australia, and Editor-â€‹â€‹in-â€‹â€‹Chief of the <a href=https://ijf.forecasters.org>InterÂ­naÂ­tional JourÂ­nal of ForeÂ­castÂ­ing</a>.  </p>
    </div>
    <div class="column small-12 medium-4">
      
      <h4 id="contact">Contact</h4>
      <ul class="fa-ul">
	
	<li><i class="fa-li fa fa-university" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.monash.edu/business/econometrics-and-business-statistics">Department of Econometrics &amp; Business Statistics, Monash University, Clayton VIC 3800, Australia.</a></li>
	
	<li><i class="fa-li fa fa-envelope" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="mailto:Rob.Hyndman@monash.edu">Rob.Hyndman@monash.edu</a></li>
	
	<li><i class="fa-li fa fa-twitter" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://twitter.com/robjhyndman">@robjhyndman</a> on Twitter</li>
	
	<li><i class="fa-li fa fa-github-alt" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://github.com/robjhyndman/">robjhyndman</a> on GitHub</li>
	
	<li><i class="fa-li ai ai-google-scholar" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://scholar.google.com/citations?user=vamErfkAAAAJ">Google Scholar</a></li>
	
      </ul>
    </div>
    <div class="column small-12 medium-4">
      <h4>Subscribe</h4>
      <p><i><i class="fa fa-rss-square" style="color:#03396c;"></i> To receive updates from this site, you can subscribe to using an <a href="http://feeds.feedburner.com/ProfessorRobJHyndman">RSS feed reader</a> or <a href="https://feedburner.google.com/fb/a/mailverify?uri=ProfessorRobJHyndman">by email</a>.</i></p>
      <h4>Search</h4>
      <a id="searchsite">
	<form method="get" action="https://duckduckgo.com/">
	  <label for="search-field" class="show-for-sr">Search the site</label>
	  <input type="search" name="q" maxlength="255" placeholder="Search the site" id="search-field">
	  <input type="hidden" name="sites" value="https://robjhyndman.com"/>
	  <input type="hidden" name="k7" value="#faf8f8"/>
	  <input type="hidden" name="kj" value="#b33"/>
	  <input type="hidden" name="ky" value="#fafafa"/>
	  <input type="hidden" name="kx" value="b"/>
	  <input type="hidden" name="ko" value="-1"/>
	  <input type="hidden" name="k1" value="-1"/>
	  <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" />
	</form>
      </a>
    </div>
  </div>
  </span>
</footer>

    <div class="endofpage">
    <footer id="footer">
    <section class="wrapper small">Powered by <a href="http://gohugo.io">Hugo</a>
    and <a href="https://github.com/rstudio/blogdown">Blogdown</a>.
     &copy; <a href="https://robjhyndman.com">Rob&nbsp;J&nbsp;Hyndman</a> 1993&ndash;2018.
    </section>
    </footer>
    </div>

    <script src="https://robjhyndman.com/js/jquery.js"></script>
    <script src="https://robjhyndman.com/js/what-input.js"></script>
    <script src="https://robjhyndman.com/js/foundation.min.js"></script>
    <script src="https://robjhyndman.com/js/finite.js"></script>

    
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script>
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>

    
    


<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-5004894-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

 </body>
</html>
