<!doctype html>
<html class="no-js" lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>Murphy diagrams in R | Rob J Hyndman</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans|Merriweather" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/foundation.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/highlight.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/academicons.min.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/finite.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/kube.css">
    <link rel="stylesheet" href="https://robjhyndman.com/css/robjhyndman.css">
</head>
  <body>
    <header>
      <nav class="nav-bar">
	
	  <div class="title-bar" data-responsive-toggle="site-menu" data-hide-for="medium">
	    <button class="site-hamburger" type="button" data-toggle>
	      <i class="fa fa-bars fa-lg" aria-hidden="true"></i>
	    </button>
	    <div class="title-bar-title site-title">
	      <a href="https://robjhyndman.com/"  style="color: #b3cde0">Rob J Hyndman</a>
	    </div>
	    <div class="title-bar-right pull-right">
	      


	    </div>
	  </div>

	  
	    <div class="top-bar" id="site-menu" >
	      <div class="top-bar-title show-for-medium site-title">
		<a href="https://robjhyndman.com/"  style="color: #b3cde0;">Rob J Hyndman</a>
	      </div>
	      <div class="top-bar-left">
		<ul class="menu vertical medium-horizontal">
		  
		  
		  <li><a href="https://robjhyndman.com/hyndsight/">Hyndsight blog</a></li>
		  
		  <li><a href="https://robjhyndman.com/publications/">Publications</a></li>
		  
		  <li><a href="https://robjhyndman.com/software/">Software</a></li>
		  
		  <li><a href="https://robjhyndman.com/seminars/">Seminars</a></li>
		  
		  <li><a href="https://robjhyndman.com/teaching/">Teaching</a></li>
		  
		  <li><a href="https://robjhyndman.com/research-team/">Research team</a></li>
		  
		  <li><a href="https://robjhyndman.com/about/">About</a></li>
		  
		</ul>
	      </div>
	      <div class="top-bar-right show-for-medium">
		


	      </div>
	    </div>
	  
	</nav>
    </header>
    <main>
      

<div class="wrapper">
<div class="units-row" style='margin-bottom: 0px;'>
<div class="unit-20">&nbsp;</div>
<div class="unit-60"><h1>Murphy diagrams in R</h1></div>
</div>
<div class="units-row">
  <div class="unit-20 dateblock" style='text-align: right;'><h4 style='padding: .8ex 0px .8ex 0px;'><a href="https://robjhyndman.com/hyndsight">Hyndsight</a></h4>
      <div class="post-metadata">
  <span class="post-date">
    <time datetime="2015-07-16 07:57:46 &#43;0000 &#43;0000" itemprop="datePublished">16 July 2015</time>
  </span>
  
  
  
  <span class="post-tags">
    <p><i class="fa fa-tags"></i>
    
    <a class="post-tag" href="https://robjhyndman.com/categories/forecasting">forecasting</a>,
     
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/graphics">graphics</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/r">R</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/statistics">statistics</a>, 
    
    
    <a class="post-tag" href="https://robjhyndman.com/categories/time-series">time series</a>
    
  </span>
  
  
</div>

    </div>
<div class="unit-60">

  <p>At the recent <a href="http://www.forecasters.org/isf"><em>International Symposium on Forecasting</em></a>, held in Riverside, California, Tillman Gneiting gave a great talk on <strong>“Evaluating forecasts: why proper scoring rules and consistent scoring functions matter”</strong>. It will be the subject of an IJF invited paper in due course.</p>
<p>One of the things he talked about was the “Murphy diagram” for comparing forecasts, as proposed in <a href="http://arxiv.org/abs/1503.08195">Ehm et al (2015)</a>. Here’s how it works for comparing mean forecasts.<!-- more --></p>
<p>It is well-known that the mean of the forecast distribution is obtained by minimizing the squared error loss function, <span class="math inline">\(S(x,y)=(x-y)^2\)</span> where <span class="math inline">\(x\)</span> is the point forecast and <span class="math inline">\(y\)</span> is the actual observation. That is
<span class="math display">\[
\text{E}(Y) = \text{min arg}_x S(x,y).
\]</span></p>
<p>An old result that is not so well known is that there are other loss functions which would also lead to the forecast mean. In fact, <a href="http://www.jstor.org/stable/2284229">Savage (1971)</a> showed that any scoring function is consistent for the mean if and only if it is of the form
<span class="math display">\[\begin{equation}\label{savage}
S(x,y) = \phi(y) - \phi(x) - \phi&#39;(x)(y-x)
\end{equation}\]</span>
where the function <span class="math inline">\(\phi\)</span> is convex with subgradient <span class="math inline">\(\phi&#39;\)</span>. Setting <span class="math inline">\(\phi(u)=u^2\)</span> gives the usual squared error result. So when comparing point forecasts that are intended to be estimates of the mean, it may not be appropriate to only compare the MSE values. A different scoring function that satisfies condition (1) may give a different ranking of competing forecasts.</p>
<p>Ehm et al (2015) showed that any scoring function satisfying condition (1) can be written as
<span class="math display">\[
S(x,y) = \int_{-\infty}^\infty S_{\theta}(x,y) dH(\theta)
\]</span>
where <span class="math inline">\(H\)</span> is a non-negative measure and
<span class="math display">\[
S_{\theta}(x,y) = \begin{cases}
  |y-\theta| &amp; \text{if} \min(x,y)\le\theta &lt; \max(x,y) \\
  0 &amp; \text{otherwise}.
\end{cases}
\]</span>
Different <span class="math inline">\(H\)</span> measures give different scoring functions, but <span class="math inline">\(S_{\theta}(x,y)\)</span> is the same for all such scoring functions.</p>
<p>So if we have point forecasts for <span class="math inline">\(n\)</span> events, we can calculate the average value of <span class="math inline">\(S_{\theta}(x,y)\)</span> for each <span class="math inline">\(\theta\)</span>:
<span class="math display">\[
s(\theta) = \frac{1}{n}\sum_{i=1}^n S_{\theta}(x_i,y_i)
\]</span>
and plot this as a function of <span class="math inline">\(\theta\)</span>. This is what Ehm et al call a “Murphy diagram”. A similar approach can be taken for quantile and expectile forecasts (with a different function <span class="math inline">\(S_\theta(x,y)\)</span> of course).</p>
<p>I have written some R code for producing these plots. Here it is applied to rolling one-step forecasts computed using ETS and ARIMA models. The data was simulated from an ARIMA model, so we would expect the ARIMA forecasts to be better:</p>
<pre class="r"><code>    source(&quot;https://robjhyndman.com/Rfiles/murphy.R&quot;)
    library(forecast)
    set.seed(2015)
    y &lt;- arima.sim(n = 300, list(ar = c(0.8897, -0.4858), ma = c(-0.2279, 0.2488)),
                   sd = sqrt(0.1796))

    # Rolling one-step forecasts
    f1 &lt;- f2 &lt;- ts(numeric(300)*NA)
    for(i in 30:299)
    {
      fit1 &lt;- ets(window(y,end=i))
      fit2 &lt;- auto.arima(window(y,end=i))
      f1[i+1] &lt;- forecast(fit1, PI=FALSE, h=1)$mean
      f2[i+1] &lt;- forecast(fit2, h=1)$mean
    }

    murphydiagram(y, f1, f2)
    legend(&quot;topleft&quot;, lty=1, col=c(&quot;blue&quot;,&quot;red&quot;), legend=c(&quot;ETS&quot;,&quot;ARIMA&quot;))</code></pre>
<p><img src="https://robjhyndman.com/hyndsight/2015-07-16-murphy-diagrams_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>    murphydiagram(y, f1, f2, type=&#39;diff&#39;, main=&quot;ETS - ARIMA&quot;)</code></pre>
<p><img src="https://robjhyndman.com/hyndsight/2015-07-16-murphy-diagrams_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<p>The shaded region shows 95% pointwise confidence intervals for the difference between the two functions.</p>
<p>Currently my R code only works for the mean function, but it would be easy enough to modify the function to handle quantiles and expectiles as well.</p>


      <meta itemprop="wordCount" content="496">
      <meta itemprop="datePublished" content="2015-07-16">
      <meta itemprop="url" content="https://robjhyndman.com/hyndsight/murphy-diagrams/">

<div class='sans' style="background: #dddddd; padding: 2em;">
<div style="padding-bottom: 1em" >
<div class="share-box">
  <ul class="share">
    <li>
      <a class="facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fmurphy-diagrams%2f" target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter" href="https://twitter.com/intent/tweet?text=Murphy%20diagrams%20in%20R. https%3a%2f%2frobjhyndman.com%2fhyndsight%2fmurphy-diagrams%2f from @robjhyndman" target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fmurphy-diagrams%2f&amp;title=Murphy%20diagrams%20in%20R" target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo" href="http://service.weibo.com/share/share.php?url=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fmurphy-diagrams%2f&amp;title=Murphy%20diagrams%20in%20R" target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email" href="mailto:?subject=Murphy%20diagrams%20in%20R&amp;body=https%3a%2f%2frobjhyndman.com%2fhyndsight%2fmurphy-diagrams%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


</div>

    <ul class="pagination" role="navigation" aria-label="Pagination">
      
      <li class="arrow" aria-disabled="true"><a href="https://robjhyndman.com/hyndsight/useful-tutorials/">&laquo; <em>Previous<span class="show-for-sr"> page</span></em>: Useful tutorials</a></li>
      
      
      <li class="arrow" aria-disabled="true"><a href="https://robjhyndman.com/hyndsight/bias-variance/"><em>Next<span class="show-for-sr"> page</span></em>: The bias-variance decomposition&nbsp;&raquo;</a></li>
      
    </ul>
    <a href="https://robjhyndman.com/hyndsight/">All Hyndsight posts by date</a>
</div>

<span style='font-family: Carlito'>
 <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
              return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'researchtips';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</span>

  </div>
  </div></div>

    </main>
    <footer class="whatisthis">
  <hr class='separator'/>
  <span style="font-family: Carlito, sans; font-size: 0.9em; line-height: 1.05em;">
  <div class="row">
    <div class="column small-12 medium-4">
      <figure class='image-left'>
      <a href="https://robjhyndman.com/" style="border-bottom: none;">
      	<img src="https://robjhyndman.com/img/rjh.png" alt="Portrait of the author" class='avatar' style="max-width: 50%;">
      </a>
  </figure>
  <p>
Rob&nbsp;J&nbsp;Hyndman is Professor of Statistics at <a href=https://www.monash.edu>Monash University</a>, Australia, and Editor-​​in-​​Chief of the <a href=https://ijf.forecasters.org>Inter­na­tional Jour­nal of Fore­cast­ing</a>.  </p>
    </div>
    <div class="column small-12 medium-4">
      
      <h4 id="contact">Contact</h4>
      <ul class="fa-ul">
	
	<li><i class="fa-li fa fa-university" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.monash.edu/business/econometrics-and-business-statistics">Department of Econometrics &amp; Business Statistics, Monash University, Clayton VIC 3800, Australia.</a></li>
	
	<li><i class="fa-li fa fa-envelope" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="mailto:Rob.Hyndman@monash.edu">Rob.Hyndman@monash.edu</a></li>
	
	<li><i class="fa-li fa fa-twitter" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://twitter.com/robjhyndman">@robjhyndman</a> on Twitter</li>
	
	<li><i class="fa-li fa fa-github-alt" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://github.com/robjhyndman/">robjhyndman</a> on GitHub</li>
	
	<li><i class="fa-li ai ai-google-scholar" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://scholar.google.com/citations?user=vamErfkAAAAJ">Google Scholar</a></li>
	
      </ul>
    </div>
    <div class="column small-12 medium-4">
      <h4>Subscribe</h4>
      <p><i><i class="fa fa-rss-square" style="color:#03396c;"></i> To receive updates from this site, you can subscribe to using an <a href="http://feeds.feedburner.com/ProfessorRobJHyndman">RSS feed reader</a> or <a href="https://feedburner.google.com/fb/a/mailverify?uri=ProfessorRobJHyndman">by email</a>.</i></p>
      <h4>Search</h4>
      <a id="searchsite">
	<form method="get" action="https://duckduckgo.com/">
	  <label for="search-field" class="show-for-sr">Search the site</label>
	  <input type="search" name="q" maxlength="255" placeholder="Search the site" id="search-field">
	  <input type="hidden" name="sites" value="https://robjhyndman.com"/>
	  <input type="hidden" name="k7" value="#faf8f8"/>
	  <input type="hidden" name="kj" value="#b33"/>
	  <input type="hidden" name="ky" value="#fafafa"/>
	  <input type="hidden" name="kx" value="b"/>
	  <input type="hidden" name="ko" value="-1"/>
	  <input type="hidden" name="k1" value="-1"/>
	  <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" />
	</form>
      </a>
    </div>
  </div>
  </span>
</footer>

    <div class="endofpage">
    <footer id="footer">
    <section class="wrapper small">Powered by <a href="http://gohugo.io">Hugo</a>
    and <a href="https://github.com/rstudio/blogdown">Blogdown</a>.
     &copy; <a href="https://robjhyndman.com">Rob&nbsp;J&nbsp;Hyndman</a> 1993&ndash;2018.
    </section>
    </footer>
    </div>

    <script src="https://robjhyndman.com/js/jquery.js"></script>
    <script src="https://robjhyndman.com/js/what-input.js"></script>
    <script src="https://robjhyndman.com/js/foundation.min.js"></script>
    <script src="https://robjhyndman.com/js/finite.js"></script>

    
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>

    <script>
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
    </script>

    
    
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
    </script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML">
    </script>
    


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5004894-1', 'auto');
ga('send', 'pageview');
</script>

 </body>
</html>
